<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-v2-demo.mrhope.site/panshuilong.github.io/Java/JVM/2024-03-21-JVM-%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98.html"><meta property="og:site_name" content="ä¸ƒåˆ†ç†Ÿ"><meta property="og:title" content="JVM-é«˜é¢‘é¢è¯•é¢˜"><meta property="og:description" content="1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ ä¸€ä¸ªç±»å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¼šç»å†äº”ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼šåŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å’Œå¸è½½ã€‚å…¶ä¸­çš„è¿æ¥åˆåˆ†ä¸ºéªŒè¯ã€å‡†å¤‡å’Œè§£æä¸‰ä¸ªæ­¥éª¤ åŠ è½½ï¼ˆLoadingï¼‰ ç®€å•ä¸€å¥è¯æ¦‚æ‹¬ï¼Œç±»çš„åŠ è½½é˜¶æ®µå°±æ˜¯ï¼šæ‰¾åˆ°éœ€è¦åŠ è½½çš„ç±»å¹¶æŠŠç±»çš„ä¿¡æ¯åŠ è½½åˆ°jvmçš„æ–¹æ³•åŒºä¸­ï¼Œç„¶ååœ¨å †åŒºä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­è¿™ä¸ªç±»çš„ä¿¡æ¯çš„å…¥å£ã€‚ç»“åˆjvmçš„å†…å­˜ç»“æ„ä¼šæ¯”è¾ƒå¥½ç†è§£ã€‚"><meta property="og:type" content="article"><meta property="og:image" content="https://vuepress-theme-hope-v2-demo.mrhope.site/panshuilong.github.io/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-09-27T06:10:35.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="JVM-é«˜é¢‘é¢è¯•é¢˜"><meta property="article:author" content="ä¸ƒåˆ†ç†Ÿ"><meta property="article:tag" content="é¢è¯•"><meta property="article:published_time" content="2024-03-21T00:00:00.000Z"><meta property="article:modified_time" content="2024-09-27T06:10:35.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"JVM-é«˜é¢‘é¢è¯•é¢˜","image":["https://vuepress-theme-hope-v2-demo.mrhope.site/panshuilong.github.io/"],"datePublished":"2024-03-21T00:00:00.000Z","dateModified":"2024-09-27T06:10:35.000Z","author":[{"@type":"Person","name":"ä¸ƒåˆ†ç†Ÿ","url":"https://github.com/panslong"}]}</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet"><title>JVM-é«˜é¢‘é¢è¯•é¢˜ | ä¸ƒåˆ†ç†Ÿ</title><meta name="description" content="1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ ä¸€ä¸ªç±»å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¼šç»å†äº”ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼šåŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å’Œå¸è½½ã€‚å…¶ä¸­çš„è¿æ¥åˆåˆ†ä¸ºéªŒè¯ã€å‡†å¤‡å’Œè§£æä¸‰ä¸ªæ­¥éª¤ åŠ è½½ï¼ˆLoadingï¼‰ ç®€å•ä¸€å¥è¯æ¦‚æ‹¬ï¼Œç±»çš„åŠ è½½é˜¶æ®µå°±æ˜¯ï¼šæ‰¾åˆ°éœ€è¦åŠ è½½çš„ç±»å¹¶æŠŠç±»çš„ä¿¡æ¯åŠ è½½åˆ°jvmçš„æ–¹æ³•åŒºä¸­ï¼Œç„¶ååœ¨å †åŒºä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­è¿™ä¸ªç±»çš„ä¿¡æ¯çš„å…¥å£ã€‚ç»“åˆjvmçš„å†…å­˜ç»“æ„ä¼šæ¯”è¾ƒå¥½ç†è§£ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/panshuilong.github.io/assets/style-2bfe29f2.css" as="style"><link rel="stylesheet" href="/panshuilong.github.io/assets/style-2bfe29f2.css">
    <link rel="modulepreload" href="/panshuilong.github.io/assets/app-058da2fa.js"><link rel="modulepreload" href="/panshuilong.github.io/assets/2024-03-21-JVM-é«˜é¢‘é¢è¯•é¢˜.html-0e0282fe.js"><link rel="modulepreload" href="/panshuilong.github.io/assets/20231031122057-b68d0099.js"><link rel="modulepreload" href="/panshuilong.github.io/assets/20240124105832-a8539fdc.js"><link rel="modulepreload" href="/panshuilong.github.io/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/panshuilong.github.io/assets/2024-03-21-JVM-é«˜é¢‘é¢è¯•é¢˜.html-cb2f021f.js"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-23f81b65.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/home.html-59221efa.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/slide.html-acf0e9da.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/cv.html-ca8ab8cb.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/guide.html-fa7a564f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/introduction.html-d1d7f1d6.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-53ff2662.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-03-10-Cç›˜ç©ºé—´æ¸…ç†.html-63eb4010.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-01-15-nginxéƒ¨ç½²diståŒ….html-f487b9fd.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-18-å¦‚ä½•è®¾è®¡ä¸€ä¸ªçŸ­é“¾ç³»ç»Ÿ.html-8b7c5951.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-01-JVM-åŸºç¡€ç¯‡.html-9e6fbd4d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-10-JVM-å®æˆ˜ç¯‡1.html-4ebf4171.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-15-JVM-å®æˆ˜ç¯‡2-GCè°ƒä¼˜.html-df66e788.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-16-JVM-å®æˆ˜ç¯‡3-æ€§èƒ½è°ƒä¼˜.html-084e2530.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2024-01-16-JVM-é¢è¯•ç¯‡.html-6a05f538.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-10-18-çº¿ç¨‹æ± .html-f9e72c25.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-18-æé«˜ç”Ÿäº§æ•ˆç‡çš„Lambdaè¡¨è¾¾å¼.html-b38ac486.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-19-CompletableFuture è¯¦è§£.html-304db3a0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-cdb474bd.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-01-çº¿æ€§æ•°æ®ç»“æ„.html-4d1e587c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-a56f96f1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2021-01-18-è¯¦è§£MySQLç´¢å¼•.html-3f7cb475.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-e494b055.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-10-Redis-åŸç†-ç½‘ç»œæ¨¡å‹.html-e8bc7824.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-RedisæŒä¹…åŒ–.html-ea962d6a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-Redisé›†ç¾¤.html-f156ce74.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-redisåšä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰.html-ee4e8b9e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-å¦‚ä½•é¿å…ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ï¼Ÿ.html-523ac1a9.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-21-æ¶ˆæ¯å †ç§¯æ€ä¹ˆå¤„ç†ï¼Ÿ.html-f399f232.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-21-ç”µå•†ç³»ç»Ÿä¸­çš„è¶…æ—¶è®¢å•æ€ä¹ˆå¤„ç†ï¼Ÿ.html-1905d72c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-22-å¦‚ä½•ç¡®ä¿MQæ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ.html-577252ee.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-21-CAP _ BASEç†è®º.html-f1b0f240.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-08-21-åˆ†å¸ƒå¼äº‹åŠ¡.html-9426f6c3.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-18-Springå¾ªç¯ä¾èµ–.html-aa19ad6f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-03-04-Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥.html-599750f9.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-03-04-æœåŠ¡é›ªå´©ï¼Œé™çº§ç†”æ–­.html-2f86318a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-03-05-æœåŠ¡é™æµ.html-3b58455c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-12-è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ¨¡å¼.html-f7c37bbe.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-å‘½ä»¤æ¨¡å¼.html-c7edfa57.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-çŠ¶æ€æ¨¡å¼.html-862f3c90.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼.html-3e755591.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-èŒè´£é“¾æ¨¡å¼.html-4df080a4.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼.html-36f97a05.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-ä¸­ä»‹è€…æ¨¡å¼.html-a88cdac1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-å¤‡å¿˜å½•æ¨¡å¼.html-cf050598.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-è®¿é—®è€…æ¨¡å¼.html-cacc4ff0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-è¿­ä»£å™¨æ¨¡å¼.html-743964ba.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-15-è®¾è®¡æ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼.html-a5a30756.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-02-è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼.html-0493f629.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-02-è®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼.html-bd35b6b0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-03-è®¾è®¡æ¨¡å¼-åŸå‹æ¨¡å¼.html-ce0c5262.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-04-è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼.html-8629ab66.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-af92460b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-06-è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼.html-c7bbf32a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-06-è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼.html-837aa4ed.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-äº«å…ƒæ¨¡å¼.html-834489ed.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼.html-c0900ccc.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-æ¡¥æ¥æ¨¡å¼.html-bdadb53a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-ç»„åˆæ¨¡å¼.html-ff47637c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-è£…é¥°è€…æ¨¡å¼.html-851ec5ae.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-f8a91bb2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/404.html-7c8d6608.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-6492ac09.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-2f613cbf.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-b7cd8999.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-19f5ea60.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-8a35278d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-2a592f64.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-84944321.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-4039582c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-254a8688.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-cfe0f023.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-87a62f6e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-904ce928.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-6eef035b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-e66fd6ea.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-77c3417e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-46422cd2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-ef409ad0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-6236962d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-c173e87b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-8199a842.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-94dfcaf5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-ef3fb2fb.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-ff1a998f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-877d12ba.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-ba21ed42.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-678c7968.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-5db5a946.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-a9802ad8.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-b75fad6d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-183fe742.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3b61442f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7ac1dd16.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-333597e7.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-0248d389.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-525a9a09.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-9398f2f3.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-01be175e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-a05f778d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-fed7752b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-c641867a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-6dec424b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-193e9d0a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-4313a286.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-4d011745.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-9718e205.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-bf7494dd.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-2abe8d7e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-175fe507.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-cf4669e2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7ade3991.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-5ded240a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-1e22f33b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-45405a0d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-1779e545.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-2c45bf0f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-303d0999.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-5c638e12.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-5e1de26b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/home.html-158c90f1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/slide.html-9f25225e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/cv.html-e58c63f5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/guide.html-6588d348.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/introduction.html-af962450.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-8fc782b2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-03-10-Cç›˜ç©ºé—´æ¸…ç†.html-74119032.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-01-15-nginxéƒ¨ç½²diståŒ….html-b126e132.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-18-å¦‚ä½•è®¾è®¡ä¸€ä¸ªçŸ­é“¾ç³»ç»Ÿ.html-f85ce75e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-01-JVM-åŸºç¡€ç¯‡.html-2f3d5f15.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-10-JVM-å®æˆ˜ç¯‡1.html-b1c46276.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-15-JVM-å®æˆ˜ç¯‡2-GCè°ƒä¼˜.html-fdd554b2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-16-JVM-å®æˆ˜ç¯‡3-æ€§èƒ½è°ƒä¼˜.html-1a4ae450.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2024-01-16-JVM-é¢è¯•ç¯‡.html-18c05e82.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-10-18-çº¿ç¨‹æ± .html-8f95db27.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-18-æé«˜ç”Ÿäº§æ•ˆç‡çš„Lambdaè¡¨è¾¾å¼.html-dfaaf453.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-19-CompletableFuture è¯¦è§£.html-829fba63.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3f547d44.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-01-çº¿æ€§æ•°æ®ç»“æ„.html-061804fa.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-f5e664f5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2021-01-18-è¯¦è§£MySQLç´¢å¼•.html-c9d4accc.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-249d7b03.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-10-Redis-åŸç†-ç½‘ç»œæ¨¡å‹.html-62a9b3e2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-RedisæŒä¹…åŒ–.html-0a4bcfd5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-Redisé›†ç¾¤.html-6156fe12.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-redisåšä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰.html-b74462f5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-11-21-å¦‚ä½•é¿å…ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€ï¼Ÿ.html-3f669f1d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-21-æ¶ˆæ¯å †ç§¯æ€ä¹ˆå¤„ç†ï¼Ÿ.html-edfc7d43.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-21-ç”µå•†ç³»ç»Ÿä¸­çš„è¶…æ—¶è®¢å•æ€ä¹ˆå¤„ç†ï¼Ÿ.html-1bf4d627.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-22-å¦‚ä½•ç¡®ä¿MQæ¶ˆæ¯çš„å¯é æ€§ï¼Ÿ.html-bdb06963.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-08-21-CAP _ BASEç†è®º.html-606e0c4f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-08-21-åˆ†å¸ƒå¼äº‹åŠ¡.html-58d32391.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-12-18-Springå¾ªç¯ä¾èµ–.html-c381b80f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-03-04-Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥.html-deb3f295.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-03-04-æœåŠ¡é›ªå´©ï¼Œé™çº§ç†”æ–­.html-7d194c88.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2023-03-05-æœåŠ¡é™æµ.html-6fbf92b6.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-12-è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ¨¡å¼.html-180b9114.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-å‘½ä»¤æ¨¡å¼.html-3c1a071d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-çŠ¶æ€æ¨¡å¼.html-54925a1b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼.html-1cf32dc6.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-èŒè´£é“¾æ¨¡å¼.html-6cbe7720.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-13-è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼.html-74fbbdd0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-ä¸­ä»‹è€…æ¨¡å¼.html-6834ae35.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-å¤‡å¿˜å½•æ¨¡å¼.html-4db1bc20.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-è®¿é—®è€…æ¨¡å¼.html-95c2c88b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-14-è®¾è®¡æ¨¡å¼-è¿­ä»£å™¨æ¨¡å¼.html-5ecb3cdc.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-15-è®¾è®¡æ¨¡å¼-è§£é‡Šå™¨æ¨¡å¼.html-42e4794d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-02-è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼.html-c8d6a2eb.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-02-è®¾è®¡æ¨¡å¼-å·¥å‚æ¨¡å¼.html-68dbd6e9.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-03-è®¾è®¡æ¨¡å¼-åŸå‹æ¨¡å¼.html-e3476b6d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-04-è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼.html-ec8c7155.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-8fb2780c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-06-è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼.html-ebc74672.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-06-è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼.html-894b2aee.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-äº«å…ƒæ¨¡å¼.html-1dae43bf.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼.html-f374f3c4.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-æ¡¥æ¥æ¨¡å¼.html-2bf5c6f0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-ç»„åˆæ¨¡å¼.html-03e283b0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/2022-11-07-è®¾è®¡æ¨¡å¼-è£…é¥°è€…æ¨¡å¼.html-2f4039eb.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3132d1bd.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/404.html-b3778360.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-e290e87e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-f75b734f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3d011063.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-d4bf18f1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-f1b3c6f6.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-654ef8e9.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3eb85602.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-703e3993.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-e47587b1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-fac7918e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-43dbaad1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-f6e941e3.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-02184055.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-75cf5afa.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-fb662336.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-cf0b2291.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-b2cac9d8.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-21090b17.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7d6714f7.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-fd64d561.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-cd8d89b6.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-06260d72.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-a0599db0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-300a9f7f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-bbabd18e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-ed311dcc.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-0ca01fad.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-94f636eb.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-98bdf103.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-c7fda01b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-299f1b49.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-2d0c9336.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-8acaf25a.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-a3445456.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-fc9c6901.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-26c5482d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3a75b920.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-6eefe0c0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7bf50293.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-56f0105b.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-94d79406.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3edc2c5c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-8ef04b12.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7a898491.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7ba61634.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-ea77f00d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7fbe5e34.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-3d190710.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-91d62f32.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-abc698d5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-40f3f69d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-561d1732.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-7b143991.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-e779a1f6.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-4cdf2e09.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-af4ce6ca.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index.html-d007ea4d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/mermaid.core-3bc16ce5.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/VuePlayground-9c6e1b2f.js" as="script"><link rel="prefetch" href="/panshuilong.github.io/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/panshuilong.github.io/"><img class="vp-nav-logo" src="/panshuilong.github.io/logo.png" alt="ä¸ƒåˆ†ç†Ÿ"><!----><span class="vp-site-name hide-in-pad">ä¸ƒåˆ†ç†Ÿ</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/panshuilong.github.io/"><span class="font-icon icon iconfont icon-home" style=""></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/Java/basics/"><!---->JavaåŸºç¡€<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link active" href="/panshuilong.github.io/Java/JVM/"><!---->JVM<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/Java/design-patterns/"><!---->è®¾è®¡æ¨¡å¼<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="è®¡ç®—æœºåŸºç¡€"><span class="title"><span class="font-icon icon iconfont icon-rank" style=""></span>è®¡ç®—æœºåŸºç¡€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/computer-basics/data-structure/"><!---->æ•°æ®ç»“æ„<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/computer-basics/Linux/"><!---->Linux<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon iconfont icon-mysql" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/database/MySQL/"><!---->MySQL<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/database/Redis/"><!---->Redis<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/database/ElasticSearch/"><!---->ElasticSearch<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="æ¡†æ¶"><span class="title"><span class="font-icon icon iconfont icon-frame" style=""></span>æ¡†æ¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/framework/Spring/"><!---->Spring<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/framework/SpringBoot/"><!---->SpringBoot<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/framework/SpringCloud/"><!---->SpringCloud<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/framework/Mybatis/"><!---->Mybatis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="åˆ†å¸ƒå¼"><span class="title"><span class="font-icon icon iconfont icon-any" style=""></span>åˆ†å¸ƒå¼</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/distributed/RabbitMQ/"><!---->RabbitMQ<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/distributed/distributed/"><!---->åˆ†å¸ƒå¼<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/panshuilong.github.io/other/"><span class="font-icon icon iconfont icon-others" style=""></span>æ‚è®°<!----></a></div><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/panshuilong.github.io/navigation/"><span class="font-icon icon iconfont icon-navigation" style=""></span>å¯¼èˆª<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å…³äº"><span class="title"><span class="font-icon icon iconfont icon-info" style=""></span>å…³äº</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/about/introduction.html"><span class="font-icon icon iconfont icon-info" style=""></span>å…³äºæœ¬ç«™<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/panshuilong.github.io/about/guide.html"><span class="font-icon icon iconfont icon-info" style=""></span>æ­å»ºæ•™ç¨‹<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/panslong/panslong.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-creative" style=""></span><span class="vp-sidebar-title">JavaåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-creative" style=""></span><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-creative" style=""></span><span class="vp-sidebar-title">è®¾è®¡æ¨¡å¼</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-article" style=""></span>JVM-é«˜é¢‘é¢è¯•é¢˜</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/panslong" target="_blank" rel="noopener noreferrer">ä¸ƒåˆ†ç†Ÿ</a></span><span property="author" content="ä¸ƒåˆ†ç†Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-03-21T00:00:00.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category1 clickable" role="navigation">JVM</span><!--]--><meta property="articleSection" content="JVM"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag2 clickable" role="navigation">é¢è¯•</span><!--]--><meta property="keywords" content="é¢è¯•"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 58 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT58M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ">1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#åŠ è½½-loading">åŠ è½½ï¼ˆLoadingï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#è¿æ¥-linking">è¿æ¥ï¼ˆLinkingï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#åˆå§‹åŒ–-initialization">åˆå§‹åŒ–(Initialization)</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#ä½¿ç”¨-using">ä½¿ç”¨ï¼ˆUsingï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#å¸è½½-unloading">å¸è½½ï¼ˆ(Unloadingï¼‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_2ã€ç±»åŠ è½½å™¨-jvmç±»åŠ è½½æœºåˆ¶">2ã€ç±»åŠ è½½å™¨ï¼Œ JVMç±»åŠ è½½æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_3ã€èƒ½è¯´ä¸€ä¸‹jvmçš„å†…å­˜åŒºåŸŸå—">3ã€èƒ½è¯´ä¸€ä¸‹JVMçš„å†…å­˜åŒºåŸŸå—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_4ã€å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—">4ã€å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_5ã€å¯¹è±¡å†…å­˜åˆ†é…æ–¹å¼">5ã€å¯¹è±¡å†…å­˜åˆ†é…æ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_6ã€jvm-é‡Œ-new-å¯¹è±¡æ—¶-å †ä¼šå‘ç”ŸæŠ¢å å—-jvmæ˜¯æ€ä¹ˆè®¾è®¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„">6ã€JVM é‡Œ new å¯¹è±¡æ—¶ï¼Œå †ä¼šå‘ç”ŸæŠ¢å å—ï¼ŸJVMæ˜¯æ€ä¹ˆè®¾è®¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_7ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€">7ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_8-å†…å­˜æ³„æ¼å¯èƒ½ç”±å“ªäº›åŸå› å¯¼è‡´å‘¢">8.å†…å­˜æ³„æ¼å¯èƒ½ç”±å“ªäº›åŸå› å¯¼è‡´å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_9-å¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»">9.å¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_10-åƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—">10.åƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_11-ä¸‰è‰²æ ‡è®°ç®—æ³•äº†è§£å—">11. ä¸‰è‰²æ ‡è®°ç®—æ³•äº†è§£å—</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_12-èƒ½è¯¦ç»†è¯´ä¸€ä¸‹cmsæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†è¿‡ç¨‹å—">12.èƒ½è¯¦ç»†è¯´ä¸€ä¸‹CMSæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_13-g1åƒåœ¾æ”¶é›†å™¨äº†è§£å—">13.G1åƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_14-æœ‰äº†cms-ä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥g1">14.æœ‰äº†CMSï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥G1ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_15-ä½ ä»¬çº¿ä¸Šç”¨çš„ä»€ä¹ˆåƒåœ¾æ”¶é›†å™¨-ä¸ºä»€ä¹ˆè¦ç”¨å®ƒ">15.ä½ ä»¬çº¿ä¸Šç”¨çš„ä»€ä¹ˆåƒåœ¾æ”¶é›†å™¨ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_16-åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•é€‰æ‹©">16.åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_17-å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸­å—-æœ‰æ²¡æœ‰äº†è§£é€ƒé€¸åˆ†ææŠ€æœ¯">17.å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸­å—ï¼Ÿæœ‰æ²¡æœ‰äº†è§£é€ƒé€¸åˆ†ææŠ€æœ¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_18-äº†è§£å“ªäº›æ€§jvmç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·">18.äº†è§£å“ªäº›æ€§JVMç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_19-jvmçš„å¸¸è§å‚æ•°é…ç½®çŸ¥é“å“ªäº›">19.JVMçš„å¸¸è§å‚æ•°é…ç½®çŸ¥é“å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_20-æœ‰æ²¡æœ‰è¿›è¡Œè¿‡jvmè°ƒä¼˜-è¯´è¯´ä½ çš„è°ƒä¼˜æ€è·¯">20.æœ‰æ²¡æœ‰è¿›è¡Œè¿‡JVMè°ƒä¼˜ï¼Œè¯´è¯´ä½ çš„è°ƒä¼˜æ€è·¯ï¼Ÿ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#jvmè°ƒä¼˜çš„ä¸€èˆ¬æ­¥éª¤ä¸º">JVMè°ƒä¼˜çš„ä¸€èˆ¬æ­¥éª¤ä¸ºï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#åˆ†ægcæ—¥å¿—åŠdumpæ–‡ä»¶-åˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–-ç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹">åˆ†æGCæ—¥å¿—åŠdumpæ–‡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–ï¼Œç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#æœ‰ç”¨è¿‡å“ªäº›jvmè°ƒä¼˜å‚æ•°å—">æœ‰ç”¨è¿‡å“ªäº›JVMè°ƒä¼˜å‚æ•°å—ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_21-çº¿ä¸ŠæœåŠ¡cpuå ç”¨è¿‡é«˜æ€ä¹ˆæ’æŸ¥">21.çº¿ä¸ŠæœåŠ¡CPUå ç”¨è¿‡é«˜æ€ä¹ˆæ’æŸ¥ï¼Ÿ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#å¯åŠ¨-arthas">å¯åŠ¨ Arthas</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#dashboard-â€”-å±•ç¤ºæ•´ä½“æƒ…å†µ">dashboard â€” å±•ç¤ºæ•´ä½“æƒ…å†µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#thread-â€”-æŸ¥çœ‹é«˜cpuçš„çº¿ç¨‹">thread â€” æŸ¥çœ‹é«˜CPUçš„çº¿ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#watch-â€”-ç›‘æ§å‚æ•°">watch â€” ç›‘æ§å‚æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#jad-â€”-åç¼–è¯‘">jad â€” åç¼–è¯‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#redefine-â€”-é‡è½½ç±»">redefine â€” é‡è½½ç±»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_22-å†…å­˜é£™é«˜é—®é¢˜æ€ä¹ˆæ’æŸ¥">22.å†…å­˜é£™é«˜é—®é¢˜æ€ä¹ˆæ’æŸ¥ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_23-é¢‘ç¹-minor-gc-æ€ä¹ˆåŠ">23.é¢‘ç¹ minor gc æ€ä¹ˆåŠï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_24-é¢‘ç¹full-gcæ€ä¹ˆåŠ">24.é¢‘ç¹Full GCæ€ä¹ˆåŠï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/panshuilong.github.io/#_25-æœ‰æ²¡æœ‰å¤„ç†è¿‡å†…å­˜æº¢å‡º-oom-é—®é¢˜-æ˜¯å¦‚ä½•å®šä½çš„">25.æœ‰æ²¡æœ‰å¤„ç†è¿‡å†…å­˜æº¢å‡º(OOM)é—®é¢˜ï¼Ÿæ˜¯å¦‚ä½•å®šä½çš„ï¼Ÿ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#mat-åˆ†æoomé—®é¢˜çš„æ€è·¯">MAT åˆ†æOOMé—®é¢˜çš„æ€è·¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#æ€»è§ˆå›¾-â€”-å¿«é€Ÿåˆ†æoomé—®é¢˜">æ€»è§ˆå›¾ â€” å¿«é€Ÿåˆ†æOOMé—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#ç›´æ–¹å›¾-â€”-å®šä½æ ¹æº">ç›´æ–¹å›¾ â€” å®šä½æ ¹æº</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/panshuilong.github.io/#çº¿ç¨‹æ ˆ-â€”-åˆ†æä»£ç ">çº¿ç¨‹æ ˆ â€” åˆ†æä»£ç </a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="_1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> 1ã€ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸€ä¸ªç±»å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¼šç»å†äº”ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼š<strong>åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ã€ä½¿ç”¨</strong>ã€å’Œ<strong>å¸è½½</strong>ã€‚å…¶ä¸­çš„è¿æ¥åˆåˆ†ä¸º<strong>éªŒè¯ã€å‡†å¤‡</strong>å’Œ<strong>è§£æ</strong>ä¸‰ä¸ªæ­¥éª¤</p><h3 id="åŠ è½½-loading" tabindex="-1"><a class="header-anchor" href="#åŠ è½½-loading" aria-hidden="true">#</a> åŠ è½½ï¼ˆLoadingï¼‰</h3><p>ç®€å•ä¸€å¥è¯æ¦‚æ‹¬ï¼Œç±»çš„åŠ è½½é˜¶æ®µå°±æ˜¯ï¼š<strong>æ‰¾åˆ°éœ€è¦åŠ è½½çš„ç±»å¹¶æŠŠç±»çš„ä¿¡æ¯åŠ è½½åˆ°jvmçš„æ–¹æ³•åŒºä¸­ï¼Œç„¶ååœ¨å †åŒºä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºä¸­è¿™ä¸ªç±»çš„ä¿¡æ¯çš„å…¥å£</strong>ã€‚ç»“åˆjvmçš„å†…å­˜ç»“æ„ä¼šæ¯”è¾ƒå¥½ç†è§£ã€‚</p><p>è¿™é‡Œè¦åŒºåˆ«ä¸€ä¸‹æ¥è§¦åˆ°çš„ç±»åŠ è½½ã€‚ç±»åŠ è½½å…¶å®åŒ…æ‹¬åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ä¸‰ä¸ªé˜¶æ®µã€‚ç±»åŠ è½½å¼ºè°ƒä¸€ä¸ªjvmèƒ½å¤Ÿç›´æ¥ä½¿ç”¨æ‰€éœ€çš„ç±»ï¼Œæ‰€ä»¥ç±»å¿…é¡»å®Œæˆåˆå§‹åŒ–ã€‚</p><p>ä¸åŒçš„è™šæ‹Ÿæœºå¯¹ç±»çš„åŠ è½½æ—¶æœºæœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå…·ä½“è¦çœ‹è™šæ‹Ÿæœºçš„å®ç°æ–¹å¼ã€‚è¿™é‡Œä¸åšå±•å¼€ã€‚</p><p>ç±»çš„åŠ è½½æ–¹å¼æ¯”è¾ƒçµæ´»ï¼Œæ€»ç»“ä¸‹æ¥æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ol><li>æ®ç±»çš„å…¨è·¯å¾„åæ‰¾åˆ°ç›¸åº”çš„classæ–‡ä»¶ï¼Œç„¶åä»classæ–‡ä»¶ä¸­è¯»å–æ–‡ä»¶å†…å®¹ï¼›ï¼ˆå¸¸ç”¨ï¼‰</li><li>ä»jaræ–‡ä»¶ä¸­è¯»å–ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸‹é¢å‡ ç§æ–¹å¼ä¹Ÿæ¯”è¾ƒå¸¸ç”¨ï¼šï¼ˆå¸¸ç”¨ï¼‰</li><li>ä»ç½‘ç»œä¸­è·å–ï¼šæ¯”å¦‚10å¹´å‰ååˆ†æµè¡Œçš„Appletã€‚</li><li>æ ¹æ®ä¸€å®šçš„è§„åˆ™å®æ—¶ç”Ÿæˆï¼Œæ¯”å¦‚è®¾è®¡æ¨¡å¼ä¸­çš„åŠ¨æ€ä»£ç†æ¨¡å¼ï¼Œå°±æ˜¯æ ¹æ®ç›¸åº”çš„ç±»è‡ªåŠ¨ç”Ÿæˆå®ƒçš„ä»£ç†ç±»ã€‚</li><li>ä»éclassæ–‡ä»¶ä¸­è·å–ï¼Œå…¶å®è¿™ä¸ç›´æ¥ä»classæ–‡ä»¶ä¸­è·å–çš„æ–¹å¼æœ¬è´¨</li></ol><h3 id="è¿æ¥-linking" tabindex="-1"><a class="header-anchor" href="#è¿æ¥-linking" aria-hidden="true">#</a> è¿æ¥ï¼ˆLinkingï¼‰</h3><ol><li><strong>éªŒè¯</strong>ï¼šè¿›è¡Œç±»çš„åˆæ³•æ€§æ ¡éªŒã€‚ä¼šå¯¹æ¯”å¦‚å­—èŠ‚ç æ ¼å¼ã€å˜é‡ä¸æ–¹æ³•çš„åˆæ³•æ€§ã€æ•°æ®ç±»å‹çš„æœ‰æ•ˆæ€§ã€ç»§æ‰¿ä¸å®ç°çš„è§„èŒƒæ€§ç­‰ç­‰è¿›è¡Œæ£€æŸ¥ï¼Œç¡®ä¿åˆ«åŠ è½½çš„ç±»èƒ½å¤Ÿæ­£å¸¸çš„è¢«jvmæ‰€æ­£å¸¸è¿è¡Œã€‚</li><li><strong>å‡†å¤‡</strong>ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ä¸ºjvmé»˜è®¤çš„åˆå€¼ï¼›å¯¹äºéé™æ€çš„å˜é‡ï¼Œåˆ™ä¸ä¼šä¸ºå®ƒä»¬åˆ†é…å†…å­˜ã€‚ç®€å•è¯´å°±æ˜¯<strong>åˆ†å†…å­˜ã€èµ‹åˆå€¼</strong>ã€‚æ³¨æ„ï¼šè®¾ç½®åˆå§‹å€¼ä¸ºjvmé»˜è®¤åˆå€¼ï¼Œè€Œä¸æ˜¯ç¨‹åºè®¾å®šã€‚è§„åˆ™å¦‚ä¸‹ <ul><li>åŸºæœ¬ç±»å‹ï¼ˆintã€longã€shortã€charã€byteã€booleanã€floatã€doubleï¼‰çš„é»˜è®¤å€¼ä¸º0</li><li>å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼ä¸ºnull</li><li>å¸¸é‡çš„é»˜è®¤å€¼ä¸ºæˆ‘ä»¬ç¨‹åºä¸­è®¾å®šçš„å€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ç¨‹åºä¸­å®šä¹‰final static int a = 100ï¼Œåˆ™å‡†å¤‡é˜¶æ®µä¸­açš„åˆå€¼å°±æ˜¯100ã€‚</li></ul></li><li><strong>è§£æ</strong>ï¼šè¿™ä¸€é˜¶æ®µçš„ä»»åŠ¡å°±æ˜¯æŠŠå¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</li></ol><ul><li></li></ul><h3 id="åˆå§‹åŒ–-initialization" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–-initialization" aria-hidden="true">#</a> åˆå§‹åŒ–(Initialization)</h3><p>ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯<strong>ç±»åŠ è½½</strong>è¿‡ç¨‹çš„æœ€åä¸€æ­¥ã€‚è€Œä¹Ÿæ˜¯åˆ°äº†è¯¥é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaç¨‹åºä»£ç (å­—èŠ‚ç )ï¼Œä¹‹å‰çš„åŠ¨ä½œéƒ½ç”±è™šæ‹Ÿæœºä¸»å¯¼ã€‚</p><p>jvmå¯¹ç±»çš„åŠ è½½æ—¶æœºæ²¡æœ‰æ˜ç¡®è§„èŒƒï¼Œä½†å¯¹ç±»çš„åˆå§‹åŒ–æ—¶æœºæœ‰ï¼š**åªæœ‰å½“ç±»è¢«ç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ã€‚**ç±»è¢«ç›´æ¥å¼•ç”¨çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š <ul><li>newå…³é”®å­—åˆ›å»ºå¯¹è±¡</li><li>è¯»å–æˆ–è®¾ç½®ç±»çš„é™æ€å˜é‡</li><li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</li></ul></li><li>é€šè¿‡åå°„æ–¹å¼æ‰§è¡Œ1é‡Œé¢çš„ä¸‰ç§æ–¹å¼ï¼›</li><li>åˆå§‹åŒ–å­ç±»çš„æ—¶å€™ï¼Œä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼›</li><li>ä½œä¸ºç¨‹åºå…¥å£ç›´æ¥è¿è¡Œæ—¶ï¼ˆè°ƒç”¨mainæ–¹æ³•ï¼‰ï¼›</li><li>æ¥å£å®ç°ç±»åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šè§¦å‘ç›´æ¥æˆ–é—´æ¥å®ç°çš„æ‰€æœ‰æ¥å£çš„åˆå§‹åŒ–ã€‚</li></ol><ul><li></li></ul><p>å…³äºç±»çš„åˆå§‹åŒ–ï¼Œè®°ä½ä¸¤å¥è¯</p><p>1ã€ç±»çš„åˆå§‹åŒ–ï¼Œä¼š<strong>è‡ªä¸Šè€Œä¸‹è¿è¡Œ</strong>é™æ€ä»£ç å—æˆ–é™æ€èµ‹å€¼è¯­å¥ï¼Œéé™æ€ä¸éèµ‹å€¼çš„é™æ€è¯­å¥å‡ä¸æ‰§è¡Œã€‚</p><p>2ã€å¦‚æœå­˜åœ¨çˆ¶ç±»ï¼Œåˆ™çˆ¶ç±»å…ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>é€’å½’</strong>æ¨¡å‹ã€‚</p><p>åŒºåˆ«äº<strong>å¯¹è±¡çš„åˆå§‹åŒ–</strong>ï¼Œç±»çš„åˆå§‹åŒ–æ‰€åšçš„ä¸€èµ·éƒ½æ˜¯åŸºäºç±»å˜é‡æˆ–ç±»è¯­å¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œçš„éƒ½æ˜¯å…±æ€§çš„æŠ½è±¡ä¿¡æ¯ã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œç±»å°±æ˜¯å¯¹è±¡å®ä¾‹çš„æŠ½è±¡ã€‚</p><h3 id="ä½¿ç”¨-using" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-using" aria-hidden="true">#</a> ä½¿ç”¨ï¼ˆUsingï¼‰</h3><p>ç±»çš„ä½¿ç”¨åˆ†ä¸º<strong>ç›´æ¥å¼•ç”¨</strong>å’Œ<strong>é—´æ¥å¼•ç”¨</strong>ã€‚</p><p>ç›´æ¥å¼•ç”¨ä¸é—´æ¥å¼•ç”¨ç­‰åˆ¤åˆ«æ¡ä»¶ï¼Œæ˜¯çœ‹å¯¹è¯¥ç±»çš„å¼•ç”¨æ˜¯å¦ä¼šå¼•èµ·ç±»çš„åˆå§‹åŒ–</p><p>ç›´æ¥å¼•ç”¨å·²ç»åœ¨ç±»çš„åˆå§‹åŒ–ä¸­çš„æœ‰è¿‡é˜è¿°ï¼Œä¸å†èµ˜è¿°ã€‚è€Œç±»çš„é—´æ¥å¼•ç”¨ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ç§æƒ…å†µï¼š</p><ol><li>å½“å¼•ç”¨äº†ä¸€ä¸ªç±»çš„é™æ€å˜é‡ï¼Œè€Œè¯¥é™æ€å˜é‡ç»§æ‰¿è‡ªçˆ¶ç±»çš„è¯ï¼Œä¸å¼•èµ·åˆå§‹åŒ–</li><li>å®šä¹‰ä¸€ä¸ªç±»çš„æ•°ç»„ï¼Œä¸ä¼šå¼•èµ·è¯¥ç±»çš„åˆå§‹åŒ–ï¼›</li><li>å½“å¼•ç”¨ä¸€ä¸ªç±»çš„çš„å¸¸é‡æ—¶ï¼Œä¸ä¼šå¼•èµ·è¯¥ç±»çš„åˆå§‹åŒ–</li></ol><h3 id="å¸è½½-unloading" tabindex="-1"><a class="header-anchor" href="#å¸è½½-unloading" aria-hidden="true">#</a> å¸è½½ï¼ˆ(Unloadingï¼‰</h3><p>å½“ç±»ä½¿ç”¨å®Œäº†ä¹‹åï¼Œç±»å°±è¦è¿›å…¥å¸è½½é˜¶æ®µäº†ã€‚é‚£ä½•ä¸ºè¡¡é‡ç±»ä½¿ç”¨å®Œçš„æ ‡å‡†å‘¢ï¼Ÿ</p><ol><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ol><p>å¦‚æœä»¥ä¸Šä¸‰ä¸ªæ¡ä»¶å…¨éƒ¨æ»¡è¶³ï¼Œjvmå°±ä¼šåœ¨æ–¹æ³•åŒºåƒåœ¾å›æ”¶çš„æ—¶å€™å¯¹ç±»è¿›è¡Œå¸è½½ï¼Œç±»çš„å¸è½½è¿‡ç¨‹å…¶å®å°±æ˜¯åœ¨æ–¹æ³•åŒºä¸­æ¸…ç©ºç±»ä¿¡æ¯ï¼Œjavaç±»çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ã€‚</p><h2 id="_2ã€ç±»åŠ è½½å™¨-jvmç±»åŠ è½½æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_2ã€ç±»åŠ è½½å™¨-jvmç±»åŠ è½½æœºåˆ¶" aria-hidden="true">#</a> 2ã€ç±»åŠ è½½å™¨ï¼Œ JVMç±»åŠ è½½æœºåˆ¶</h2><figure><img src="/panshuilong.github.io/assets/58d39c4085603513a6b29e935c4ed2f-549a43ed.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¸Šé¢çš„ç±»åŠ è½½è¿‡ç¨‹ä¸»è¦æ˜¯é€šè¿‡ç±»åŠ è½½å™¨æ¥å®ç°çš„ï¼ŒJavaé‡Œæœ‰å¦‚ä¸‹å‡ ç§ç±»åŠ è½½å™¨</p><ul><li><p>å¼•å¯¼ç±»åŠ è½½å™¨ï¼šè´Ÿè´£åŠ è½½æ”¯æ’‘JVMè¿è¡Œçš„ä½äºJREçš„libç›®å½•ä¸‹çš„æ ¸å¿ƒç±»åº“ï¼Œæ¯”å¦‚rt.jarã€charsets.jarç­‰</p></li><li><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼šè´Ÿè´£åŠ è½½æ”¯æ’‘JVMè¿è¡Œçš„ä½äºJREçš„libç›®å½•ä¸‹çš„extæ‰©å±•ç›®å½•ä¸­çš„JARç±»åŒ…</p></li><li><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼šè´Ÿè´£åŠ è½½ClassPathè·¯å¾„ä¸‹çš„ç±»åŒ…ï¼Œä¸»è¦å°±æ˜¯åŠ è½½ä½ è‡ªå·±å†™çš„é‚£äº›ç±»</p></li><li><p>è‡ªå®šä¹‰åŠ è½½å™¨ï¼šè´Ÿè´£åŠ è½½ç”¨æˆ·è‡ªå®šä¹‰è·¯å¾„ä¸‹çš„ç±»åŒ…</p></li></ul><p><strong>JDK8ä»¥ååºŸå¼ƒæ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰çš„åŸå› </strong></p><p>JDK8ä»¥åï¼Œä½¿ç”¨å¹³å°ç±»åŠ è½½å™¨ï¼ˆPlatform ClassLoaderï¼‰æ›¿æ¢äº†åŸæ¥çš„æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ã€‚æœ‰ä¸¤ä¸ªåŸºæœ¬çš„åŸå› å½’çº³å¦‚ä¸‹ï¼š</p><p>åœ¨JDK8ä¸­çš„è¿™ä¸ªExtension ClassLoaderï¼Œä¸»è¦ç”¨äºåŠ è½½jreç¯å¢ƒä¸‹çš„libä¸‹çš„extä¸‹çš„jaråŒ…ã€‚å½“æƒ³è¦æ‰©å±•Javaçš„åŠŸèƒ½çš„æ—¶å€™ï¼ŒæŠŠjaråŒ…æ”¾åˆ°è¿™ä¸ªextæ–‡ä»¶å¤¹ä¸‹ã€‚ç„¶è€Œè¿™æ ·çš„åšæ³•å¹¶ä¸å®‰å…¨ï¼Œä¸æå€¡ä½¿ç”¨ã€‚</p><p>è¿™ç§æ‰©å±•æœºåˆ¶è¢«**JDK9å¼€å§‹åŠ å…¥çš„â€œæ¨¡å—åŒ–å¼€å‘â€**çš„å¤©ç„¶çš„æ‰©å±•èƒ½åŠ›æ‰€å–ä»£ã€‚</p><p>æ€»ä¹‹ï¼Œæ‰©å±•èƒ½åŠ›è¢«å–ä»£äº†åˆä¸å®‰å…¨ï¼Œæ‰€ä»¥è¢«åºŸå¼ƒã€‚</p><h2 id="_3ã€èƒ½è¯´ä¸€ä¸‹jvmçš„å†…å­˜åŒºåŸŸå—" tabindex="-1"><a class="header-anchor" href="#_3ã€èƒ½è¯´ä¸€ä¸‹jvmçš„å†…å­˜åŒºåŸŸå—" aria-hidden="true">#</a> 3ã€èƒ½è¯´ä¸€ä¸‹JVMçš„å†…å­˜åŒºåŸŸå—ï¼Ÿ</h2><figure><img src="/panshuilong.github.io/assets/20210305173849710-1028d1e6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>1ã€ç¨‹åºè®¡æ•°å™¨</strong></p><p>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ä¹Ÿè¢«ç§°ä¸º<strong>PCå¯„å­˜å™¨</strong>ï¼Œæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ã€‚</p><p>å®ƒå¯ä»¥çœ‹ä½œæ˜¯<strong>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚</p><p><strong>2ã€Javaè™šæ‹Ÿæœºæ ˆ</strong></p><p>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰<strong>ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ</strong></p><p><strong>ä½œç”¨</strong>ï¼šä¸»ç®¡ Java ç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„<strong>å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›</strong>ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ ˆæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„åˆ†é…å­˜å‚¨æ–¹å¼ï¼Œè®¿é—®é€Ÿåº¦ä»…æ¬¡äºç¨‹åºè®¡æ•°å™¨</li><li>JVM ç›´æ¥å¯¹è™šæ‹Ÿæœºæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€<strong>å…¥æ ˆ</strong>ï¼ˆè¿›æ ˆ/å‹æ ˆï¼‰ï¼Œæ–¹æ³•æ‰§è¡Œç»“æŸ<strong>å‡ºæ ˆ</strong></li><li><strong>æ ˆä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜</strong></li></ul><p><strong>æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸</strong>ï¼š</p><p>Java è™šæ‹Ÿæœºè§„èŒƒå…è®¸ <strong>Javaè™šæ‹Ÿæœºæ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„</strong></p><ul><li>å¦‚æœé‡‡ç”¨å›ºå®šå¤§å°çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œé‚£æ¯ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡ Java è™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <strong>StackOverflowError</strong> å¼‚å¸¸</li><li>å¦‚æœ Java è™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª<strong>OutOfMemoryError</strong>å¼‚å¸¸</li></ul><p>å¯ä»¥é€šè¿‡å‚æ•°-Xssæ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦ã€‚</p><p><strong>3ã€æœ¬åœ°æ–¹æ³•æ ˆ</strong></p><ul><li>Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„</li><li>å…è®¸çº¿ç¨‹å›ºå®šæˆ–è€…å¯åŠ¨æ€æ‰©å±•çš„å†…å­˜å¤§å°</li><li>å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡æœ¬åœ°æ–¹æ³•æ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª StackOverflowError å¼‚å¸¸</li><li>å¦‚æœæœ¬åœ°æ–¹æ³•æ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„æœ¬åœ°æ–¹æ³•æ ˆï¼Œé‚£ä¹ˆ Javaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ªOutofMemoryErrorå¼‚å¸¸</li><li>æœ¬åœ°æ–¹æ³•æ˜¯ä½¿ç”¨ C è¯­è¨€å®ç°çš„</li><li>å®ƒçš„å…·ä½“åšæ³•æ˜¯ Native Method Stack ä¸­ç™»è®° native æ–¹æ³•ï¼Œåœ¨ Execution Engine æ‰§è¡Œæ—¶åŠ è½½æœ¬åœ°æ–¹æ³•åº“å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ—¶ï¼Œå®ƒå°±è¿›å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å¹¶ä¸”ä¸å†å—è™šæ‹Ÿæœºé™åˆ¶çš„ä¸–ç•Œã€‚å®ƒå’Œè™šæ‹Ÿæœºæ‹¥æœ‰åŒæ ·çš„æƒé™ã€‚</li><li>æœ¬åœ°æ–¹æ³•å¯ä»¥é€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å£æ¥è®¿é—®è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå®ƒç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°å¤„ç†å™¨ä¸­çš„å¯„å­˜å™¨ï¼Œç›´æ¥ä»æœ¬åœ°å†…å­˜çš„å †ä¸­åˆ†é…ä»»æ„æ•°é‡çš„å†…å­˜</li><li>å¹¶ä¸æ˜¯æ‰€æœ‰ JVM éƒ½æ”¯æŒæœ¬åœ°æ–¹æ³•ã€‚å› ä¸º Java è™šæ‹Ÿæœºè§„èŒƒå¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚æœ¬åœ°æ–¹æ³•æ ˆçš„ä½¿ç”¨è¯­è¨€ã€å…·ä½“å®ç°æ–¹å¼ã€æ•°æ®ç»“æ„ç­‰ã€‚å¦‚æœ JVM äº§å“ä¸æ‰“ç®—æ”¯æŒ native æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ— éœ€å®ç°æœ¬åœ°æ–¹æ³•æ ˆ</li><li>åœ¨ Hotspot JVM ä¸­ï¼Œç›´æ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€</li></ul><p><strong>4ã€Javaå †</strong></p><p>å¯¹äºJavaåº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒJavaå †ï¼ˆJava Heapï¼‰æ˜¯è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯<strong>å­˜æ”¾å¯¹è±¡å®ä¾‹</strong>ï¼ŒJavaé‡Œâ€œ<strong>å‡ ä¹</strong>â€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p><p>Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„å†…å­˜åŒºåŸŸï¼Œå› æ­¤ä¸€äº›èµ„æ–™ä¸­å®ƒä¹Ÿè¢«ç§°ä½œâ€œGCå †â€ï¼ˆGarbage Collected Heapï¼Œï¼‰ã€‚ä»å›æ”¶å†…å­˜çš„è§’åº¦çœ‹ï¼Œç”±äºç°ä»£åƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡çš„ï¼Œæ‰€ä»¥Javaå †ä¸­ç»å¸¸ä¼šå‡ºç°æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€Edenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ç­‰åè¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ç§åˆ’åˆ†åªæ˜¯æ ¹æ®åƒåœ¾å›æ”¶æœºåˆ¶æ¥è¿›è¡Œçš„åˆ’åˆ†ï¼Œä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒæœ¬èº«åˆ¶å®šçš„ã€‚</p><p><strong>5.æ–¹æ³•åŒº</strong></p><ul><li>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸ Java å †ä¸€æ ·ï¼Œæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚</li><li>è™½ç„¶ Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå« Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸ Java å †åŒºåˆ†å¼€ã€‚</li><li><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬/å­—æ®µ/æ–¹æ³•/æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†ç±»åœ¨åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚è¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯ String.intern()æ–¹æ³•ã€‚å—æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</li><li>æ–¹æ³•åŒºçš„å¤§å°å’Œå †ç©ºé—´ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°ä¹Ÿå¯é€‰æ‹©å¯æ‰©å±•ï¼Œæ–¹æ³•åŒºçš„å¤§å°å†³å®šäº†ç³»ç»Ÿå¯ä»¥æ”¾å¤šå°‘ä¸ªç±»ï¼Œå¦‚æœç³»ç»Ÿç±»å¤ªå¤šï¼Œå¯¼è‡´æ–¹æ³•åŒºæº¢å‡ºï¼Œè™šæ‹ŸæœºåŒæ ·ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºé”™è¯¯</li><li>JVM å…³é—­åæ–¹æ³•åŒºå³è¢«é‡Šæ”¾</li></ul><h2 id="_4ã€å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_4ã€å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—" aria-hidden="true">#</a> 4ã€å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹äº†è§£å—ï¼Ÿ</h2><p>è™šæ‹Ÿæœºæ”¶åˆ°newæŒ‡ä»¤è§¦å‘ã€‚</p><p>ç±»åŠ è½½æ£€æŸ¥ï¼šå¦‚æœç±»æ²¡æœ‰è¢«ç±»åŠ è½½å™¨åŠ è½½ï¼Œåˆ™æ‰§è¡Œç±»åŠ è½½æµç¨‹ï¼ˆå°†classä¿¡æ¯åŠ è½½åˆ°JVMçš„è¿è¡Œæ—¶æ•°æ®åŒºçš„è¿‡ç¨‹ï¼‰ï¼Œå¯¹è±¡æ‰€éœ€å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œåå¯ä»¥å®Œå…¨ç¡®å®šã€‚</p><p>å¯¹è±¡åˆ†é…å†…å­˜ï¼šä»å †ä¸­åˆ’åˆ†å‡ºä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ã€‚</p><p>å†…å­˜ç©ºé—´åˆå§‹åŒ–ï¼šå†…å­˜åˆ†é…å®Œåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆå¦‚ï¼šintå€¼ä¸º0ï¼Œbooleanå€¼ä¸ºfalseç­‰ï¼‰ï¼Œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨Javaä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>ä¸ºå¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼šè™šæ‹Ÿæœºä¸ºå¯¹è±¡è¿›è¡Œè®¾ç½®ï¼Œå¦‚è®¾ç½®å¯¹è±¡å±äºå“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚</p><p>ä»è™šæ‹Ÿæœºçš„è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»åˆ›å»ºå®Œæ¯•ã€‚ä½†ä»Javaç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œæ‰€æœ‰çš„å­—æ®µè¿˜æ˜¯é›¶å€¼ï¼Œæ‰€ä»¥éœ€è¦ç¨‹åºå‘˜è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚</p><p>initæ˜¯å¯¹å¯¹è±¡çº§åˆ«çš„å˜é‡æˆ–éé™æ€ä»£ç å—è¿›è¡Œåˆå§‹åŒ–çš„</p><p>clinité™æ€å˜é‡æˆ–è€…é™æ€ä»£ç å—è°æ¥åˆå§‹åŒ–å‘¢</p><h2 id="_5ã€å¯¹è±¡å†…å­˜åˆ†é…æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_5ã€å¯¹è±¡å†…å­˜åˆ†é…æ–¹å¼" aria-hidden="true">#</a> 5ã€å¯¹è±¡å†…å­˜åˆ†é…æ–¹å¼</h2><p>è™šæ‹Ÿæœºä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ï¼Œä»å †ä¸­åˆ’å‡ºä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ï¼Œå› ä¸ºå¯¹è±¡æ‰€éœ€å†…å­˜çš„å¤§å°åœ¨ç±»åŠ è½½å®Œåå¯ä»¥å®Œå…¨ç¡®å®šã€‚</p><p>å †å†…å­˜æ˜¯å¦è§„æ•´ï¼š</p><figure><img src="/panshuilong.github.io/assets/2024032115571100-2a7aaded.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>å †å†…å­˜è§„æ•´ï¼šå·²ä½¿ç”¨çš„å†…å­˜åœ¨ä¸€è¾¹ï¼Œæœªä½¿ç”¨å†…å­˜åœ¨å¦ä¸€è¾¹ã€‚</li><li>å †å†…å­˜ä¸è§„æ•´ï¼šå·²ä½¿ç”¨å†…å­˜å’Œæœªä½¿ç”¨ç›¸äº’äº¤é”™ã€‚</li></ul><p>å †å†…å­˜æ˜¯å¦è§„æ•´æ˜¯ç”±åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šçš„ã€‚</p><p><strong>å†…å­˜åˆ†é…æ–¹å¼ï¼š</strong></p><p>åˆ†é…æ–¹å¼çš„é€‰æ‹© å–å†³äº Javaå †å†…å­˜æ˜¯å¦è§„æ•´ï¼š</p><figure><img src="/panshuilong.github.io/assets/c1281dc551694b49862edaf1acb96b77-a73750d6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>ç©ºé—²åˆ—è¡¨ï¼š</p></li><li><ul><li>å †å†…å­˜ä¸è§„æ•´ã€‚</li><li>åˆ†é…è¿‡ç¨‹ï¼šè™šæ‹Ÿæœºå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®°å½•å¯ç”¨å†…å­˜å—çš„åˆ—è¡¨ï¼Œåœ¨åˆ†é…æ—¶ä»åˆ—è¡¨æ‰¾ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ã€‚</li></ul></li></ul><p>Javaå †æ˜¯å¦è§„æ•´ ç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š</p><h2 id="_6ã€jvm-é‡Œ-new-å¯¹è±¡æ—¶-å †ä¼šå‘ç”ŸæŠ¢å å—-jvmæ˜¯æ€ä¹ˆè®¾è®¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„" tabindex="-1"><a class="header-anchor" href="#_6ã€jvm-é‡Œ-new-å¯¹è±¡æ—¶-å †ä¼šå‘ç”ŸæŠ¢å å—-jvmæ˜¯æ€ä¹ˆè®¾è®¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„" aria-hidden="true">#</a> 6ã€JVM é‡Œ new å¯¹è±¡æ—¶ï¼Œå †ä¼šå‘ç”ŸæŠ¢å å—ï¼ŸJVMæ˜¯æ€ä¹ˆè®¾è®¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h2><p>å¯¹è±¡åˆ›å»ºåœ¨è™šæ‹Ÿæœºä¸­æ˜¯éå¸¸é¢‘ç¹çš„æ“ä½œï¼Œå³ä½¿ä»…ä»…ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ä¹Ÿä¼šå¼•èµ·çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><p><strong>è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</strong></p><figure><img src="/panshuilong.github.io/assets/2024032116011201-41f7c54c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>é‡‡ç”¨CASåˆ†é…é‡è¯•çš„æ–¹å¼æ¥ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§</li><li>æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆThread Local AllocationBufferï¼ŒTLABï¼‰ï¼Œè¦åˆ†é…å†…å­˜çš„çº¿ç¨‹ï¼Œå…ˆåœ¨æœ¬åœ°ç¼“å†²åŒºä¸­åˆ†é…ï¼Œåªæœ‰æœ¬åœ°ç¼“å†²åŒºç”¨å®Œäº†ï¼Œåˆ†é…æ–°çš„ç¼“å­˜åŒºæ—¶æ‰éœ€è¦åŒæ­¥é”å®šã€‚-XX:+UseTLAB</li></ul><p>è™šæ‹Ÿæœº1.8é»˜è®¤ä½¿ç”¨çš„æ˜¯ TLAB æ–¹å¼æ¥è¿›è¡Œå†…å­˜åˆ†é…çš„ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨CASæ–¹å¼ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® -XXï¼š-UseTLAB å‚æ•°æ¥å…³é—­TLABåŠŸèƒ½å³å¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTLAB ç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œä»…å æœ‰æ•´ä¸ª Eden ç©ºé—´çš„ 1%ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ -XX:TLABWasteTargetPercent è®¾ç½® TLAB ç©ºé—´æ‰€å ç”¨ Eden ç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ã€‚å¦‚æœé€šè¿‡TLABåˆ†é…å¤±è´¥çš„æ—¶å€™ï¼Œåˆ™ä¼šå›åˆ°EdenåŒºé€šè¿‡ CAS æ–¹å¼è¿›è¡Œåˆ†é…ã€‚</p><h2 id="_7ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€" tabindex="-1"><a class="header-anchor" href="#_7ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€" aria-hidden="true">#</a> 7ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h2><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆHotSpotï¼‰ä¸­ï¼Œå¯¹è±¡åœ¨ Java å†…å­˜ä¸­çš„ å­˜å‚¨å¸ƒå±€ å¯åˆ†ä¸ºä¸‰å—ï¼š</p><ol><li>å¯¹è±¡å¤´ å­˜å‚¨åŒºåŸŸ</li><li>å®ä¾‹æ•°æ® å­˜å‚¨åŒºåŸŸ</li><li>å¯¹é½å¡«å…… å­˜å‚¨åŒºåŸŸ</li></ol><p><strong>å¯¹è±¡å¤´åŒºåŸŸï¼š</strong></p><figure><img src="/panshuilong.github.io/assets/2024032116051241-0fcd5e17.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚ï¼šå“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€‚</p><p>å­˜å‚¨å¯¹è±¡ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼ŒJVMå¯ä»¥ç¡®å®šè¿™ä¸ªå¯¹è±¡å±äºå“ªä¸ªç±»çš„å®ä¾‹ã€‚</p><p>å¦‚æœæ˜¯æ•°ç»„ï¼Œå¯¹è±¡å¤´ä¸­è¿˜æœ‰ä¸€å—è®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ã€‚</p><p><strong>å®ä¾‹æ•°æ®åŒºåŸŸï¼š</strong></p><ul><li>ä»£ç ä¸­å®šä¹‰çš„å­—æ®µå†…å®¹ã€‚</li></ul><p><strong>å¯¹é½å¡«å……åŒºåŸŸï¼š</strong></p><ul><li>å ä½ç¬¦ã€‚</li><li>éå¿…é¡»ã€‚</li></ul><p>è¯´æ˜ï¼šå ä½ç¬¦èµ·å ä½ä½œç”¨ï¼Œå› ä¸ºå¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œè€Œå› HotSpot VMçš„è¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œä¸”å¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯8å­—èŠ‚çš„å€æ•°ã€‚å› æ­¤ï¼Œå½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼ˆå³å¯¹è±¡çš„å¤§å°ä¸æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼‰ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚</p><h2 id="_8-å†…å­˜æ³„æ¼å¯èƒ½ç”±å“ªäº›åŸå› å¯¼è‡´å‘¢" tabindex="-1"><a class="header-anchor" href="#_8-å†…å­˜æ³„æ¼å¯èƒ½ç”±å“ªäº›åŸå› å¯¼è‡´å‘¢" aria-hidden="true">#</a> 8.å†…å­˜æ³„æ¼å¯èƒ½ç”±å“ªäº›åŸå› å¯¼è‡´å‘¢ï¼Ÿ</h2><p><strong>é™æ€é›†åˆç±»å¼•èµ·å†…å­˜æ³„æ¼</strong></p><p>é™æ€é›†åˆçš„ç”Ÿå‘½å‘¨æœŸå’Œ JVM ä¸€è‡´ï¼Œæ‰€ä»¥é™æ€é›†åˆå¼•ç”¨çš„å¯¹è±¡ä¸èƒ½è¢«é‡Šæ”¾ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OOM</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">oomTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å•ä¾‹æ¨¡å¼</strong></p><p>å’Œä¸Šé¢çš„ä¾‹å­åŸç†ç±»ä¼¼ï¼Œå•ä¾‹å¯¹è±¡åœ¨åˆå§‹åŒ–åä¼šä»¥é™æ€å˜é‡çš„æ–¹å¼åœ¨ JVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ã€‚å¦‚æœå•ä¾‹å¯¹è±¡æŒæœ‰å¤–éƒ¨çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡å°†ä¸èƒ½è¢« GC å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p><p><strong>æ•°æ®è¿æ¥ã€IOã€Socketç­‰è¿æ¥</strong></p><p>åˆ›å»ºçš„è¿æ¥ä¸å†ä½¿ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨ <strong>close</strong> æ–¹æ³•å…³é—­è¿æ¥ï¼Œåªæœ‰è¿æ¥è¢«å…³é—­åï¼ŒGC æ‰ä¼šå›æ”¶å¯¹åº”çš„å¯¹è±¡ï¼ˆConnectionï¼ŒStatementï¼ŒResultSetï¼ŒSessionï¼‰ã€‚å¿˜è®°å…³é—­è¿™äº›èµ„æºä¼šå¯¼è‡´æŒç»­å æœ‰å†…å­˜ï¼Œæ— æ³•è¢« GC å›æ”¶ã€‚</p><p><strong>å˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ</strong></p><p>ä¸€ä¸ªå˜é‡çš„å®šä¹‰ä½œç”¨åŸŸå¤§äºå…¶ä½¿ç”¨èŒƒå›´ï¼Œå¾ˆå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ï¼›æˆ–ä¸å†ä½¿ç”¨å¯¹è±¡æ²¡æœ‰åŠæ—¶å°†å¯¹è±¡è®¾ç½®ä¸º nullï¼Œå¾ˆå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚</p><p><strong>hashå€¼å‘ç”Ÿå˜åŒ–</strong></p><p>å¯¹è±¡Hashå€¼æ”¹å˜ï¼Œä½¿ç”¨HashMapã€HashSetç­‰å®¹å™¨ä¸­æ—¶å€™ï¼Œç”±äºå¯¹è±¡ä¿®æ”¹ä¹‹åçš„Hahå€¼å’Œå­˜å‚¨è¿›å®¹å™¨æ—¶çš„Hashå€¼ä¸åŒï¼Œæ‰€ä»¥æ— æ³•æ‰¾åˆ°å­˜å…¥çš„å¯¹è±¡ï¼Œè‡ªç„¶ä¹Ÿæ— æ³•å•ç‹¬åˆ é™¤äº†ï¼Œè¿™ä¹Ÿä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚è¯´å¥é¢˜å¤–è¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆStringç±»å‹è¢«è®¾ç½®æˆäº†ä¸å¯å˜ç±»å‹ã€‚</p><p><strong>ThreadLocalä½¿ç”¨ä¸å½“</strong></p><p>ThreadLocalçš„å¼±å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ä¹Ÿæ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ï¼Œä½¿ç”¨å®ŒThreadLocalä¸€å®šè¦è®°å¾—ä½¿ç”¨removeæ–¹æ³•æ¥è¿›è¡Œæ¸…é™¤ã€‚</p><h2 id="_9-å¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»" tabindex="-1"><a class="header-anchor" href="#_9-å¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»" aria-hidden="true">#</a> 9.å¦‚ä½•åˆ¤æ–­å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Ÿ</h2><p><strong>1ã€reference countï¼ˆå¼•ç”¨è®¡æ•°ï¼‰</strong></p><p><strong>å¼•ç”¨è®¡æ•°æ³•</strong>ä¼šä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨æ—¶åŠ 1ï¼Œå–æ¶ˆå¼•ç”¨æ—¶å‡1ã€‚</p><p>å¼•ç”¨è®¡æ•°æ³•çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æœ‰ä¸¤ç‚¹ï¼š</p><p>1.æ¯æ¬¡å¼•ç”¨å’Œå–æ¶ˆå¼•ç”¨éƒ½éœ€è¦ç»´æŠ¤è®¡æ•°å™¨ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“</p><p>2.å­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæ‰€è°“å¾ªç¯å¼•ç”¨å°±æ˜¯å½“Aå¼•ç”¨Bï¼ŒBåŒæ—¶å¼•ç”¨Aæ—¶ä¼šå‡ºç°å¯¹è±¡æ— æ³•å›æ”¶çš„é—®é¢˜ã€‚</p><p><strong>2ã€Root Searchingï¼ˆæ ¹å¯è¾¾ç®—æ³•æˆ–æ ¹æœç´¢ç®—æ³•ï¼‰</strong></p><p><strong>æ‰€è°“çš„â€œæ ¹â€å³æ˜¯</strong>ï¼šæ‰€æœ‰çš„ç¨‹åºéƒ½æ˜¯ä» main æ–¹æ³•æ¥è¿è¡Œï¼Œåœ¨ main æ–¹æ³•é‡Œé¢ new å‡ºæ¥çš„å¯¹è±¡å³ä¸ºæ ¹å¯¹è±¡ã€‚</p><p><strong>ä¾‹å¦‚</strong>ï¼šåœ¨ main æ–¹æ³•é‡Œé¢æˆ‘ä»¬ new äº†ä¸€ä¸ª list é›†åˆï¼Œåœ¨ list é›†åˆä¸­æˆ‘ä»¬åˆå¯ä»¥å­˜æ”¾è‹¥å¹²å…¶ä»–å¯¹è±¡ï¼Œé‚£æˆ‘ä»¬å°±ç§° list ä¸ºæ ¹å¯¹è±¡ï¼Œæˆ‘ä»¬é¡ºç€æ ¹çš„æ•°æ®ç»“æ„å¾€ä¸‹èµ°ï¼Œåªè¦å­˜åœ¨å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼Œé‚£è¯¥å¯¹è±¡å°±ä¸æ˜¯åƒåœ¾ï¼Œåä¹‹ä¸å­˜åœ¨å¼•ç”¨çš„å¯¹è±¡ï¼Œé‚£è¯¥å¯¹è±¡å°±æ˜¯åƒåœ¾ã€‚</p><p><strong>æ ¹å¯¹è±¡ï¼ˆrootï¼‰çš„ç±»å‹</strong></p><p>æ ¹å¯¹è±¡ä¸ä»…ä»…åŒ…æ‹¬æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ main æ–¹æ³•é‡Œé¢çš„å¯¹è±¡ï¼Œå±äºæ ¹å¯¹è±¡çš„è¿˜æœ‰ä»¥ä¸‹è¿™äº›ï¼š</p><p>å¯ä»¥ä½œä¸ºGC Rootsçš„ä¸»è¦æœ‰å››ç§å¯¹è±¡ï¼š</p><ul><li><p>è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡</p></li><li><ul><li>æ¯”å¦‚:å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰ã€‚</li></ul></li><li><p>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</p></li><li><ul><li>æ¯”å¦‚: Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li></ul></li><li><p>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</p></li><li><ul><li>æ¯”å¦‚:å­—ç¬¦ä¸²å¸¸é‡æ± (String Table)é‡Œçš„å¼•ç”¨</li></ul></li><li><p>æ‰€æœ‰è¢«åŒæ­¥é”synchroni zedæŒæœ‰çš„å¯¹è±¡</p></li></ul><h2 id="_10-åƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_10-åƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—" aria-hidden="true">#</a> 10.åƒåœ¾æ”¶é›†ç®—æ³•äº†è§£å—ï¼Ÿ</h2><p>åƒåœ¾æ”¶é›†ç®—æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š</p><ol><li><p><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong></p><p>è§åçŸ¥ä¹‰ï¼Œæ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>æ ‡è®°</strong> : æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li><li><strong>æ¸…é™¤</strong>ï¼šå›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</li></ul><p>æ ‡è®°-æ¸…é™¤ç®—æ³•æ¯”è¾ƒåŸºç¡€ï¼Œä½†æ˜¯ä¸»è¦å­˜åœ¨ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ul><li>æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®šï¼Œå¦‚æœJavaå †ä¸­åŒ…å«å¤§é‡å¯¹è±¡ï¼Œè€Œä¸”å…¶ä¸­å¤§éƒ¨åˆ†æ˜¯éœ€è¦è¢«å›æ”¶çš„ï¼Œè¿™æ—¶å¿…é¡»è¿›è¡Œå¤§é‡æ ‡è®°å’Œæ¸…é™¤çš„åŠ¨ä½œï¼Œå¯¼è‡´æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œæ•ˆç‡éƒ½éšå¯¹è±¡æ•°é‡å¢é•¿è€Œé™ä½ã€‚</li><li>å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œæ ‡è®°ã€æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å½“ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚</li></ul></li><li><p><strong>æ ‡è®°-å¤åˆ¶ç®—æ³•</strong></p><p>æ ‡è®°-å¤åˆ¶ç®—æ³•è§£å†³äº†æ ‡è®°-æ¸…é™¤ç®—æ³•é¢å¯¹å¤§é‡å¯å›æ”¶å¯¹è±¡æ—¶æ‰§è¡Œæ•ˆç‡ä½çš„é—®é¢˜ã€‚</p><p>è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼šå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚</p><p>è¿™ç§ç®—æ³•å­˜åœ¨ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šä¸€éƒ¨åˆ†ç©ºé—´æ²¡æœ‰ä½¿ç”¨ï¼Œå­˜åœ¨ç©ºé—´çš„æµªè´¹ã€‚</p><p>æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†ä¸»è¦é‡‡ç”¨è¿™ç§ç®—æ³•ï¼Œå› ä¸ºæ–°ç”Ÿä»£çš„å­˜æ´»å¯¹è±¡æ¯”è¾ƒå°‘ï¼Œæ¯æ¬¡å¤åˆ¶çš„åªæ˜¯å°‘é‡çš„å­˜æ´»å¯¹è±¡ã€‚å½“ç„¶ï¼Œå®é™…æ–°ç”Ÿä»£çš„æ”¶é›†ä¸æ˜¯æŒ‰ç…§è¿™ä¸ªæ¯”ä¾‹ã€‚</p></li><li><p><strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong></p></li></ol><p>ä¸ºäº†é™ä½å†…å­˜çš„æ¶ˆè€—ï¼Œå¼•å…¥ä¸€ç§é’ˆå¯¹æ€§çš„ç®—æ³•ï¼šæ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚</p><p>å…¶ä¸­çš„æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘å†…å­˜ç©ºé—´ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p>æ ‡è®°-æ•´ç†ç®—æ³•ä¸»è¦ç”¨äºè€å¹´ä»£ï¼Œç§»åŠ¨å­˜æ´»å¯¹è±¡æ˜¯ä¸ªæä¸ºè´Ÿé‡çš„æ“ä½œï¼Œè€Œä¸”è¿™ç§æ“ä½œéœ€è¦Stop The Worldæ‰èƒ½è¿›è¡Œï¼Œåªæ˜¯ä»æ•´ä½“çš„ååé‡æ¥è€ƒé‡ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•æ›´åŠ åˆé€‚ã€‚</p><h2 id="_11-ä¸‰è‰²æ ‡è®°ç®—æ³•äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_11-ä¸‰è‰²æ ‡è®°ç®—æ³•äº†è§£å—" aria-hidden="true">#</a> 11. ä¸‰è‰²æ ‡è®°ç®—æ³•äº†è§£å—</h2><p>ä¸‰è‰²æ ‡è®°ç®—æ³•:</p><p>1.ç”¨äºåƒåœ¾å›æ”¶å™¨å‡çº§ï¼Œå°†STWå˜ä¸ºå¹¶å‘æ ‡è®°ã€‚STWå°±æ˜¯åœ¨æ ‡è®°åƒåœ¾çš„æ—¶å€™ï¼Œå¿…é¡»æš‚åœç¨‹åºï¼Œè€Œä½¿ç”¨å¹¶å‘æ ‡è®°ï¼Œå°±æ˜¯ç¨‹åºä¸€è¾¹è¿è¡Œï¼Œä¸€è¾¹æ ‡è®°åƒåœ¾ã€‚</p><p>2.é¿å…é‡å¤æ‰«æå¯¹è±¡ï¼Œæå‡æ ‡è®°é˜¶æ®µçš„æ•ˆç‡</p><p><strong>ä»€ä¹ˆæ˜¯ä¸‰è‰²ï¼š</strong></p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“<strong>ä¸‰è‰²æ ‡è®°æ³•å°±æ˜¯æ ¹æ®å¯è¾¾æ€§åˆ†æ</strong>ï¼Œ<strong>ä»GC Rootså¼€å§‹è¿›è¡Œéå†è®¿é—®</strong>ï¼Œåœ¨éå†å¯¹è±¡è¿‡ç¨‹ä¸­ï¼ŒæŒ‰â€œæ˜¯å¦æ£€æŸ¥è¿‡â€è¿™ä¸ªæ¡ä»¶å°†å¯¹è±¡æ ‡è®°æˆä¸‰ç§é¢œè‰²ï¼š</p><p><strong>ç™½è‰²</strong>ï¼šè¯¥å¯¹è±¡æ²¡æœ‰è¢«æ ‡è®°è¿‡ã€‚ï¼ˆå¯¹è±¡åƒåœ¾ï¼‰</p><p><strong>ç°è‰²</strong>ï¼šè¯¥å¯¹è±¡å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œä½†è¯¥å¯¹è±¡ä¸‹çš„å±æ€§æ²¡æœ‰å…¨è¢«æ ‡è®°å®Œã€‚ï¼ˆGCéœ€è¦ä»æ­¤å¯¹è±¡ä¸­å»å¯»æ‰¾åƒåœ¾ï¼‰</p><p><strong>é»‘è‰²</strong>ï¼šè¯¥å¯¹è±¡å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œä¸”è¯¥å¯¹è±¡ä¸‹çš„å±æ€§ä¹Ÿå…¨éƒ¨éƒ½è¢«æ ‡è®°è¿‡äº†ã€‚ï¼ˆç¨‹åºæ‰€éœ€è¦çš„å¯¹è±¡ï¼‰</p><figure><img src="/panshuilong.github.io/assets/ä¸‰è‰²æ ‡è®°æŸ¥æ‰¾è¿‡ç¨‹-7a76a923.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‡è®¾ç°åœ¨æœ‰ç™½ã€ç°ã€é»‘ä¸‰ä¸ªé›†åˆï¼ˆè¡¨ç¤ºå½“å‰å¯¹è±¡çš„é¢œè‰²ï¼‰ï¼Œå…¶éå†è®¿é—®è¿‡ç¨‹ä¸ºï¼š</p><p>åˆå§‹æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½åœ¨ã€ç™½è‰²é›†åˆã€‘ä¸­ï¼›</p><p>å°† GC Rootsç›´æ¥å¼•ç”¨åˆ°çš„å¯¹è±¡æŒªåˆ°ã€ç°è‰²é›†åˆã€‘ä¸­ï¼›</p><p>ä»ç°è‰²é›†åˆä¸­è·å–å¯¹è±¡ï¼š</p><p>3.1. å°†æœ¬å¯¹è±¡å¼•ç”¨åˆ°çš„å…¶ä»–å¯¹è±¡å…¨éƒ¨æŒªåˆ°ã€ç°è‰²é›†åˆã€‘ä¸­ï¼›</p><p>3.2. å°†æœ¬å¯¹è±¡æŒªåˆ°ã€é»‘è‰²é›†åˆã€‘é‡Œé¢ã€‚</p><p>é‡å¤æ­¥éª¤3ï¼Œç›´è‡³ã€ç°è‰²é›†åˆã€‘ä¸ºç©ºæ—¶ç»“æŸã€‚</p><p>ç»“æŸåï¼Œä»åœ¨ã€ç™½è‰²é›†åˆã€‘çš„å¯¹è±¡å³ä¸ºGC Rootsä¸å¯è¾¾ï¼Œå¯ä»¥è¿›è¡Œå›æ”¶ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œä¼ ç»Ÿæ ‡è®°æ–¹å¼å‘ç”ŸStop The Worldæ—¶ï¼Œå¯¹è±¡é—´çš„å¼•ç”¨æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œå¯ä»¥è½»æ¾å®Œæˆæ ‡è®°ã€‚</p><p>è€Œå¹¶å‘æ ‡è®°åœ¨æ ‡è®°æœŸé—´åº”ç”¨çº¿ç¨‹è¿˜åœ¨ç»§ç»­è·‘ï¼Œå¯¹è±¡é—´çš„å¼•ç”¨å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šå‡ºç°é”™æ ‡å’Œæ¼æ ‡çš„æƒ…å†µå°±æœ‰å¯èƒ½å‘ç”Ÿã€‚</p><p><strong>å­˜åœ¨çš„é—®é¢˜</strong></p><ul><li><p><strong>æµ®åŠ¨åƒåœ¾</strong>ï¼šå¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥ä¸€ä¸ªå·²ç»è¢«æ ‡è®°æˆé»‘è‰²æˆ–è€…ç°è‰²çš„å¯¹è±¡ï¼Œçªç„¶å˜æˆäº†åƒåœ¾ï¼Œç”±äºä¸ä¼šå†å¯¹é»‘è‰²æ ‡è®°è¿‡çš„å¯¹è±¡é‡æ–°æ‰«æ,æ‰€ä»¥ä¸ä¼šè¢«å‘ç°ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¸æ˜¯ç™½è‰²çš„ä½†æ˜¯ä¸ä¼šè¢«æ¸…é™¤ï¼Œé‡æ–°æ ‡è®°ä¹Ÿä¸èƒ½ä»GC Rootä¸­å»æ‰¾åˆ°ï¼Œæ‰€ä»¥æˆä¸ºäº†æµ®åŠ¨åƒåœ¾ï¼Œ<strong>æµ®åŠ¨åƒåœ¾å¯¹ç³»ç»Ÿçš„å½±å“ä¸å¤§ï¼Œç•™ç»™ä¸‹ä¸€æ¬¡GCè¿›è¡Œå¤„ç†å³å¯</strong>ã€‚</p></li><li><p><strong>å¯¹è±¡æ¼æ ‡é—®é¢˜</strong>ï¼ˆéœ€è¦çš„å¯¹è±¡è¢«å›æ”¶ï¼‰ï¼šå¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹å°†ä¸€ä¸ªæœªè¢«æ‰«æè¿‡çš„ç™½è‰²å¯¹è±¡æ–­å¼€å¼•ç”¨æˆä¸ºåƒåœ¾ï¼ˆåˆ é™¤å¼•ç”¨ï¼‰ï¼ŒåŒæ—¶é»‘è‰²å¯¹è±¡å¼•ç”¨äº†è¯¥å¯¹è±¡ï¼ˆå¢åŠ å¼•ç”¨ï¼‰ï¼ˆè¿™ä¸¤éƒ¨å¯ä»¥ä¸åˆ†å…ˆåé¡ºåºï¼‰ï¼›å› ä¸ºé»‘è‰²å¯¹è±¡çš„å«ä¹‰ä¸ºå…¶å±æ€§éƒ½å·²ç»è¢«æ ‡è®°è¿‡äº†ï¼Œé‡æ–°æ ‡è®°ä¹Ÿä¸ä¼šä»é»‘è‰²å¯¹è±¡ä¸­å»æ‰¾ï¼Œå¯¼è‡´è¯¥å¯¹è±¡è¢«ç¨‹åºæ‰€éœ€è¦ï¼Œå´åˆè¦è¢«GCå›æ”¶ï¼Œæ­¤é—®é¢˜ä¼šå¯¼è‡´ç³»ç»Ÿå‡ºç°é—®é¢˜ï¼Œè€ŒCMSä¸G1ï¼Œä¸¤ç§å›æ”¶å™¨åœ¨ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•æ—¶ï¼Œéƒ½é‡‡å–äº†ä¸€äº›æªæ–½æ¥åº”å¯¹è¿™äº›é—®é¢˜ï¼Œ<strong>CMSå¯¹å¢åŠ å¼•ç”¨ç¯èŠ‚è¿›è¡Œå¤„ç†ï¼ˆIncrement Updateï¼‰ï¼ŒG1åˆ™å¯¹åˆ é™¤å¼•ç”¨ç¯èŠ‚è¿›è¡Œå¤„ç†(SATB)ã€‚</strong></p></li></ul><p>æ€»ç»“</p><p>ä¸‰è‰²æ ‡è®°ç®—æ³•æ˜¯æ ¹å¯è¾¾ç®—æ³•çš„ä¸€ç§å®ç°æ–¹æ¡ˆï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æ‰¾å‡ºæ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚ä¸‰è‰²æ ‡è®°ç®—æ³•ä¼šäº§ç”Ÿå¤šæ ‡å’Œæ¼æ ‡é—®é¢˜ï¼Œå…¶ä¸­æ¼æ ‡é—®é¢˜æœ€ä¸¥é‡ã€‚æ¼æ ‡é—®é¢˜ä¼šå¯¼è‡´æœ¬è¯¥å­˜æ´»çš„å¯¹è±¡è¢«å›æ”¶ï¼Œä»è€Œå¯¼è‡´ä¸¥é‡çš„ç¨‹åºé—®é¢˜ã€‚</p><h2 id="_12-èƒ½è¯¦ç»†è¯´ä¸€ä¸‹cmsæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†è¿‡ç¨‹å—" tabindex="-1"><a class="header-anchor" href="#_12-èƒ½è¯¦ç»†è¯´ä¸€ä¸‹cmsæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†è¿‡ç¨‹å—" aria-hidden="true">#</a> 12.èƒ½è¯¦ç»†è¯´ä¸€ä¸‹CMSæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†è¿‡ç¨‹å—ï¼Ÿ</h2><p>CMSæ”¶é›†é½çš„åƒåœ¾æ”¶é›†åˆ†ä¸ºå››æ­¥ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°</strong>ï¼ˆCMS initial markï¼‰ï¼šå•çº¿ç¨‹è¿è¡Œï¼Œéœ€è¦Stop The Worldï¼Œæ ‡è®°GC Rootsèƒ½ç›´è¾¾çš„å¯¹è±¡ã€‚</li><li><strong>å¹¶å‘æ ‡è®°</strong>ï¼ˆï¼ˆCMS concurrent markï¼‰ï¼šæ— åœé¡¿ï¼Œå’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œä»GC Rootsç›´è¾¾å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾ã€‚</li><li><strong>é‡æ–°æ ‡è®°</strong>ï¼ˆCMS remarkï¼‰ï¼šå¤šçº¿ç¨‹è¿è¡Œï¼Œéœ€è¦Stop The Worldï¼Œæ ‡è®°å¹¶å‘æ ‡è®°é˜¶æ®µäº§ç”Ÿå¯¹è±¡ã€‚</li><li><strong>å¹¶å‘æ¸…é™¤</strong>ï¼ˆCMS concurrent sweepï¼‰ï¼šæ— åœé¡¿ï¼Œå’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œæ¸…ç†æ‰æ ‡è®°é˜¶æ®µæ ‡è®°çš„æ­»äº¡çš„å¯¹è±¡ã€‚</li></ul><p>Concurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/panshuilong.github.io/assets/20231031122057-4adb9793.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‚æ•°ï¼š-XX:+UseConcMarkSweepGC</p><table><thead><tr><th>å›æ”¶å¹´ä»£å’Œç®—æ³•</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>è€å¹´ä»£,æ ‡è®°æ¸…é™¤ç®—æ³•</td><td>ç³»ç»Ÿç”±äºåƒåœ¾å›æ”¶å‡ºç°çš„åœ é¡¿æ—¶é—´è¾ƒçŸ­ï¼Œç”¨æˆ·ä½“éªŒå¥½</td><td>1ã€å†…å­˜ç¢ç‰‡é—®é¢˜ 2ã€é€€åŒ–é—®é¢˜ 3ã€æµ®åŠ¨åƒåœ¾é—®é¢˜</td><td>å¤§å‹çš„äº’è”ç½‘ç³»ç»Ÿä¸­ç”¨æˆ·è¯·æ±‚æ•° æ®é‡å¤§ã€é¢‘ç‡é«˜çš„åœºæ™¯ æ¯”å¦‚è®¢å•æ¥å£ã€å•†å“æ¥å£ç­‰</td></tr></tbody></table><p>CMSåƒåœ¾å›æ”¶å™¨å­˜åœ¨çš„é—®é¢˜</p><p>ç¼ºç‚¹ï¼š</p><p>1ã€CMSä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œåœ¨åƒåœ¾æ”¶é›†ç»“æŸä¹‹åä¼šå‡ºç°å¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼ŒCMSä¼šåœ¨Full GCæ—¶è¿›è¡Œç¢ç‰‡çš„æ•´ç†ã€‚ è¿™æ ·ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹æš‚åœï¼Œå¯ä»¥ä½¿ç”¨-XX:CMSFullGCsBeforeCompaction=N å‚æ•°ï¼ˆé»˜è®¤0ï¼‰è°ƒæ•´Næ¬¡Full GCä¹‹ åå†æ•´ç†ã€‚</p><p>2.ã€æ— æ³•å¤„ç†åœ¨å¹¶å‘æ¸…ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„â€œæµ®åŠ¨åƒåœ¾â€ï¼Œä¸èƒ½åšåˆ°å®Œå…¨çš„åƒåœ¾å›æ”¶ã€‚</p><p>3ã€å¦‚æœè€å¹´ä»£å†…å­˜ä¸è¶³æ— æ³•åˆ†é…å¯¹è±¡ï¼ŒCMSå°±ä¼šé€€åŒ–æˆSerial Oldå•çº¿ç¨‹å›æ”¶è€å¹´ä»£ã€‚</p><p>4ã€å¹¶å‘é˜¶æ®µä¼šå½±å“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œçš„æ€§èƒ½</p><h2 id="_13-g1åƒåœ¾æ”¶é›†å™¨äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#_13-g1åƒåœ¾æ”¶é›†å™¨äº†è§£å—" aria-hidden="true">#</a> 13.G1åƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ</h2><p>Garbage Firstï¼ˆç®€ç§°G1ï¼‰æ”¶é›†å™¨æ˜¯åƒåœ¾æ”¶é›†å™¨çš„ä¸€ä¸ªé¢ è¦†æ€§çš„äº§ç‰©ï¼Œå®ƒå¼€åˆ›äº†å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºRegionçš„å†…å­˜å¸ƒå±€å½¢å¼ã€‚</p><p>è™½ç„¶G1ä¹Ÿä»æ˜¯éµå¾ªåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡çš„ï¼Œä½†å…¶å †å†…å­˜çš„å¸ƒå±€ä¸å…¶ä»–æ”¶é›†å™¨æœ‰éå¸¸æ˜æ˜¾çš„å·®å¼‚ã€‚ä»¥å‰çš„æ”¶é›†å™¨åˆ†ä»£æ˜¯åˆ’åˆ†æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æŒä¹…ä»£ç­‰ã€‚</p><p><strong>G1æŠŠè¿ç»­çš„Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆ<strong><strong>Region</strong></strong>ï¼‰</strong>ï¼Œæ¯ä¸€ä¸ªRegionéƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ‰®æ¼”æ–°ç”Ÿä»£çš„Edenç©ºé—´ã€Survivorç©ºé—´ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ã€‚æ”¶é›†å™¨èƒ½å¤Ÿå¯¹æ‰®æ¼”ä¸åŒè§’è‰²çš„Regioné‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»å¤„ç†ã€‚</p><p><strong>æ›´ç²¾ç»†çš„æ§åˆ¶ã€å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´ã€å†…å­˜ç¢ç‰‡çš„æ§åˆ¶ã€ä¼˜å…ˆçº§å¤„ç†</strong></p><figure><img src="/panshuilong.github.io/assets/20240124105832-56c74fd4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‚æ•°1ï¼š -XX:+UseG1GC æ‰“å¼€G1çš„å¼€å…³ï¼Œ JDK9ä¹‹åé»˜è®¤ä¸éœ€è¦æ‰“å¼€</p><p>å‚æ•°2ï¼š-XX:MaxGCPauseMillis=æ¯«ç§’å€¼ æœ€å¤§æš‚åœçš„æ—¶é—´</p><p>G1æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹å¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°</strong>ï¼ˆinitial markï¼‰ï¼Œæ ‡è®°äº†ä»GC Rootå¼€å§‹ç›´æ¥å…³è”å¯è¾¾çš„å¯¹è±¡ã€‚STWï¼ˆStop the Worldï¼‰æ‰§è¡Œã€‚</li><li><strong>å¹¶å‘æ ‡è®°</strong>ï¼ˆconcurrent markingï¼‰ï¼Œå’Œç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ã€</li><li><strong>æœ€ç»ˆæ ‡è®°</strong>ï¼ˆRemarkï¼‰ï¼ŒSTWï¼Œæ ‡è®°å†å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­äº§ç”Ÿçš„åƒåœ¾ã€‚= é‡æ–°æ ‡è®°ï¼ˆæ ‡è®°çš„èŒƒå›´æ›´å°ï¼‰</li><li><strong>ç­›é€‰å›æ”¶</strong>ï¼ˆLive Data Counting And Evacuationï¼‰ï¼Œåˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œé€‰æ‹©å¤šä¸ªRegion æ„æˆå›æ”¶é›†ï¼ŒæŠŠå›æ”¶é›†ä¸­Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§ Regionçš„å…¨éƒ¨ç©ºé—´ã€‚éœ€è¦STWã€‚</li></ul><h2 id="_14-æœ‰äº†cms-ä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥g1" tabindex="-1"><a class="header-anchor" href="#_14-æœ‰äº†cms-ä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥g1" aria-hidden="true">#</a> 14.æœ‰äº†CMSï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥G1ï¼Ÿ</h2><p>ä¼˜ç‚¹ï¼šCMSæœ€ä¸»è¦çš„ä¼˜ç‚¹åœ¨åå­—ä¸Šå·²ç»ä½“ç°å‡ºæ¥â€”â€”å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚</p><p>ç¼ºç‚¹ï¼šCMSåŒæ ·æœ‰ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ã€‚</p><ul><li>Mark Sweepç®—æ³•ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡æ¯”è¾ƒå¤š</li><li>CMSçš„å¹¶å‘èƒ½åŠ›æ¯”è¾ƒä¾èµ–äºCPUèµ„æºï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹å¯èƒ½ä¼šæŠ¢å ç”¨æˆ·çº¿ç¨‹çš„èµ„æºï¼Œå¯¼è‡´ç”¨æˆ·ç¨‹åºæ€§èƒ½ä¸‹é™ã€‚</li><li>å¹¶å‘æ¸…é™¤é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹ä¾ç„¶åœ¨è¿è¡Œï¼Œä¼šäº§ç”Ÿæ‰€è°“çš„ç†â€œæµ®åŠ¨åƒåœ¾â€ï¼ˆFloating Garbageï¼‰ï¼Œæœ¬æ¬¡åƒåœ¾æ”¶é›†æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¿…é¡»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ‰èƒ½å¤„ç†ã€‚å¦‚æœæµ®åŠ¨åƒåœ¾å¤ªå¤šï¼Œä¼šè§¦å‘æ–°çš„åƒåœ¾å›æ”¶ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ã€‚</li></ul><p>G1ä¸»è¦è§£å†³äº†å†…å­˜ç¢ç‰‡è¿‡å¤šçš„é—®é¢˜ã€‚</p><h2 id="_15-ä½ ä»¬çº¿ä¸Šç”¨çš„ä»€ä¹ˆåƒåœ¾æ”¶é›†å™¨-ä¸ºä»€ä¹ˆè¦ç”¨å®ƒ" tabindex="-1"><a class="header-anchor" href="#_15-ä½ ä»¬çº¿ä¸Šç”¨çš„ä»€ä¹ˆåƒåœ¾æ”¶é›†å™¨-ä¸ºä»€ä¹ˆè¦ç”¨å®ƒ" aria-hidden="true">#</a> 15.ä½ ä»¬çº¿ä¸Šç”¨çš„ä»€ä¹ˆåƒåœ¾æ”¶é›†å™¨ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Ÿ</h2><p><strong>å¸¸è§çš„åƒåœ¾å›æ”¶å™¨:</strong></p><p><strong>æ–°ç”Ÿä»£æ”¶é›†å™¨(é«˜ååé‡)ï¼š</strong> Serialã€ParNewã€Parallel Scavenge</p><p><strong>è€å¹´ä»£æ”¶é›†å™¨ï¼ˆSWTåœé¡¿æ—¶é—´ï¼‰ï¼š</strong> Serial Oldã€CMSã€Parallel Old</p><p><strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ”¶é›†å™¨ï¼š</strong> G1ã€ZGCã€Shenandoah</p><p>æ¯ç§åƒåœ¾å›æ”¶å™¨ä¹‹é—´ä¸æ˜¯ç‹¬ç«‹æ“ä½œçš„ï¼Œä¸‹å›¾è¡¨ç¤ºåƒåœ¾å›æ”¶å™¨ä¹‹é—´æœ‰è¿çº¿è¡¨ç¤ºï¼Œå¯ä»¥åä½œä½¿ç”¨ï¼š</p><figure><img src="/panshuilong.github.io/assets/20210403210732814-2fe32930.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¸€èˆ¬çš„<a href="https://so.csdn.net/so/search?q=%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">åƒåœ¾å›æ”¶å™¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ­é…ä¸ºï¼š</p><ul><li>Serial Newï¼ˆå¤åˆ¶ç®—æ³•ã€‚å•çº¿ç¨‹ï¼Œä¸èƒ½åˆ©ç”¨å¤šæ ¸ï¼‰ + Serial Oldï¼ˆæ ‡è®°æ•´ç†ã€‚å•çº¿ç¨‹ï¼‰ (Serialç³»åˆ—æ˜¯å•çº¿ç¨‹ï¼ŒGCæ—¶stop the world) <strong>JDK 5 ç‰ˆæœ¬ä¹‹å‰</strong></li></ul><p><strong>JDK8 ï¼š</strong></p><ul><li><p>ParNewï¼ˆå¤åˆ¶ç®—æ³•ã€‚å¹¶è¡Œã€‚ å•æ ¸æƒ…å†µä¸‹ä¸å¦‚Serialï¼‰ + CMSï¼ˆæ ‡è®°æ¸…é™¤ã€‚å¹¶å‘ï¼‰</p></li><li><ul><li><strong>é€‚åˆç±»å‹</strong>ï¼šé€‚ç”¨äºéœ€è¦ä½åœé¡¿æ—¶é—´çš„åº”ç”¨ï¼Œå¦‚ Web æœåŠ¡å™¨ã€åº”ç”¨æœåŠ¡å™¨ã€‚</li><li><strong>ç¤ºä¾‹åº”ç”¨</strong>ï¼šç”µå•†ç½‘ç«™ã€åœ¨çº¿æ¸¸æˆã€é«˜å¹¶å‘æœåŠ¡å™¨ã€‚</li><li><strong>4-8Gå¯ä»¥ç”¨ParNew+CMS</strong></li></ul></li><li><p>Parallel Scavengeï¼ˆå¤åˆ¶ç®—æ³•ã€‚å¹¶è¡Œï¼Œååé‡ä¼˜å…ˆæ”¶é›†å™¨ï¼‰ + Parallel Oldï¼ˆæ ‡è®°æ•´ç†ã€‚å¹¶è¡Œï¼‰</p></li><li><ul><li><strong>é€‚åˆç±»å‹</strong>ï¼šé€‚ç”¨äºå¤šæ ¸å¤„ç†å™¨çš„é«˜ååé‡åº”ç”¨ã€‚</li><li><strong>ç¤ºä¾‹åº”ç”¨</strong>ï¼šç§‘å­¦è®¡ç®—ã€æ•°æ®åˆ†æã€å¤§è§„æ¨¡æ•°æ®å¤„ç†ã€‚</li><li><strong>4Gä»¥ä¸‹å¯ä»¥ç”¨parallel</strong></li></ul></li><li><p>G1 ï¼ˆå¹´è½»ä»£ï¼šå¤åˆ¶ è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†ï¼‰<strong>JDK 9 é»˜è®¤çš„æ”¶é›†å™¨</strong> è¦æ±‚å°½å¯èƒ½å¯æ§ GC åœé¡¿æ—¶é—´ï¼›å†…å­˜å ç”¨è¾ƒå¤§çš„åº”ç”¨ã€‚</p></li><li><ul><li><strong>é€‚åˆç±»å‹</strong>ï¼šé€‚ç”¨äºéœ€è¦å¯é¢„æµ‹åœé¡¿æ—¶é—´çš„åº”ç”¨ï¼Œå°¤å…¶æ˜¯å¤§å †å†…å­˜çš„åº”ç”¨ã€‚</li><li><strong>ç¤ºä¾‹åº”ç”¨</strong>ï¼šä¼ä¸šçº§åº”ç”¨ã€ä¸­å¤§è§„æ¨¡ Web æœåŠ¡ã€åº”ç”¨å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿã€‚</li><li><strong>8Gä»¥ä¸Šå¯ä»¥ç”¨G1</strong></li></ul></li></ul><p>zgc:é€‚ç”¨äºéœ€è¦æä½åœé¡¿æ—¶é—´ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰çš„å¤§å†…å­˜åº”ç”¨</p><ul><li><ul><li><strong>é€‚åˆç±»å‹</strong>ï¼šé€‚ç”¨äºéœ€è¦æä½åœé¡¿æ—¶é—´ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰çš„å¤§å†…å­˜åº”ç”¨ã€‚</li><li><strong>ç¤ºä¾‹åº”ç”¨</strong>ï¼šå†…å­˜å¯†é›†å‹æ•°æ®åº“ã€é‡‘èäº¤æ˜“ç³»ç»Ÿã€äº‘æœåŠ¡ã€‚</li><li><strong>å‡ ç™¾Gä»¥ä¸Šç”¨ZGC</strong></li></ul></li><li></li></ul><p>æ€ä¹ˆæŸ¥é»˜è®¤ç”¨çš„GCæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>java -XX:+PrintCommandLineFlags -version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°æœ‰è¿™ä¹ˆä¸€è¡Œï¼š</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>-XX:+UseParallelGC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>UseParallelGC = Parallel Scavenge + Parallel Oldï¼Œè¡¨ç¤ºçš„æ˜¯æ–°ç”Ÿä»£ç”¨çš„Parallel Scavengeæ”¶é›†å™¨ï¼Œè€å¹´ä»£ç”¨çš„æ˜¯Parallel Old æ”¶é›†å™¨ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªå‘¢ï¼Ÿé»˜è®¤çš„å‘—ã€‚</p><p>å½“ç„¶é¢è¯•è‚¯å®šä¸èƒ½è¿™ä¹ˆç­”ã€‚</p><p>Parallel Scavengeçš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>é«˜ååï¼Œæˆ‘ä»¬å¯ä»¥å›ç­”ï¼šå› ä¸ºæˆ‘ä»¬ç³»ç»Ÿæ˜¯ä¸šåŠ¡ç›¸å¯¹å¤æ‚ï¼Œä½†å¹¶å‘å¹¶ä¸æ˜¯éå¸¸é«˜ï¼Œæ‰€ä»¥å¸Œæœ›å°½å¯èƒ½çš„åˆ©ç”¨å¤„ç†å™¨èµ„æºï¼Œå‡ºäºæé«˜ååé‡çš„è€ƒè™‘é‡‡ç”¨Parallel Scavenge + Parallel Oldçš„ç»„åˆã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªé»˜è®¤è™½ç„¶ä¹Ÿæœ‰è¯´æ³•ï¼Œä½†ä¸å¤ªè®¨å–œã€‚</p><p>è¿˜å¯ä»¥è¯´ï¼š</p><p>é‡‡ç”¨Parallel New+CMSçš„ç»„åˆï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œæ‰€ä»¥é‡‡ç”¨äº†CMSæ¥é™ä½åœé¡¿æ—¶é—´ã€‚</p><p>æˆ–è€…ä¸€æ­¥åˆ°ä½ï¼š</p><p>æˆ‘ä»¬çº¿ä¸Šé‡‡ç”¨äº†è®¾è®¡æ¯”è¾ƒä¼˜ç§€çš„G1åƒåœ¾æ”¶é›†å™¨ï¼Œå› ä¸ºå®ƒä¸ä»…æ»¡è¶³æˆ‘ä»¬ä½åœé¡¿çš„è¦æ±‚ï¼Œè€Œä¸”è§£å†³äº†CMSçš„æµ®åŠ¨åƒåœ¾é—®é¢˜ã€å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</p><h2 id="_16-åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_16-åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•é€‰æ‹©" aria-hidden="true">#</a> 16.åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</h2><p>åƒåœ¾æ”¶é›†å™¨çš„é€‰æ‹©éœ€è¦æƒè¡¡çš„ç‚¹è¿˜æ˜¯æ¯”è¾ƒå¤šçš„â€”â€”ä¾‹å¦‚è¿è¡Œåº”ç”¨çš„åŸºç¡€è®¾æ–½å¦‚ä½•ï¼Ÿä½¿ç”¨JDKçš„å‘è¡Œå•†æ˜¯ä»€ä¹ˆï¼Ÿç­‰ç­‰â€¦â€¦</p><p>è¿™é‡Œç®€å•åœ°åˆ—ä¸€ä¸‹ä¸Šé¢æåˆ°çš„ä¸€äº›æ”¶é›†å™¨çš„é€‚ç”¨åœºæ™¯ï¼š</p><ul><li>Serial ï¼šå¦‚æœåº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªå¾ˆå°çš„å†…å­˜ç©ºé—´ï¼ˆå¤§çº¦100 MBï¼‰äº¦æˆ–å®ƒåœ¨æ²¡æœ‰åœé¡¿æ—¶é—´è¦æ±‚çš„å•çº¿ç¨‹å¤„ç†å™¨ä¸Šè¿è¡Œã€‚</li><li>Parallelï¼šå¦‚æœä¼˜å…ˆè€ƒè™‘åº”ç”¨ç¨‹åºçš„å³°å€¼æ€§èƒ½ï¼Œå¹¶ä¸”æ²¡æœ‰æ—¶é—´è¦æ±‚è¦æ±‚ï¼Œæˆ–è€…å¯ä»¥æ¥å—1ç§’æˆ–æ›´é•¿çš„åœé¡¿æ—¶é—´ã€‚</li><li>CMS/G1ï¼šå¦‚æœå“åº”æ—¶é—´æ¯”ååé‡ä¼˜å…ˆçº§é«˜ï¼Œæˆ–è€…åƒåœ¾æ”¶é›†æš‚åœå¿…é¡»ä¿æŒåœ¨å¤§çº¦1ç§’ä»¥å†…ã€‚</li><li>ZGCï¼šå¦‚æœå“åº”æ—¶é—´æ˜¯é«˜ä¼˜å…ˆçº§çš„ï¼Œæˆ–è€…å †ç©ºé—´æ¯”è¾ƒå¤§ã€‚</li></ul><h2 id="_17-å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸­å—-æœ‰æ²¡æœ‰äº†è§£é€ƒé€¸åˆ†ææŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#_17-å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸­å—-æœ‰æ²¡æœ‰äº†è§£é€ƒé€¸åˆ†ææŠ€æœ¯" aria-hidden="true">#</a> 17.å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸­å—ï¼Ÿæœ‰æ²¡æœ‰äº†è§£é€ƒé€¸åˆ†ææŠ€æœ¯ï¼Ÿ</h2><p><strong>å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸­å—ï¼Ÿ</strong> ä¸ä¸€å®šçš„ã€‚</p><p>éšç€JITç¼–è¯‘æœŸçš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚å…¶å®ï¼Œåœ¨ç¼–è¯‘æœŸé—´ï¼ŒJITä¼šå¯¹ä»£ç åšå¾ˆå¤šä¼˜åŒ–ã€‚å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä¼˜åŒ–çš„ç›®çš„å°±æ˜¯å‡å°‘å†…å­˜å †åˆ†é…å‹åŠ›ï¼Œå…¶ä¸­ä¸€ç§é‡è¦çš„æŠ€æœ¯å«åšé€ƒé€¸åˆ†æã€‚</p><p><strong>ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æï¼Ÿ</strong></p><p><strong>é€ƒé€¸åˆ†æ</strong>æ˜¯æŒ‡åˆ†ææŒ‡é’ˆåŠ¨æ€èŒƒå›´çš„æ–¹æ³•ï¼Œå®ƒåŒç¼–è¯‘å™¨ä¼˜åŒ–åŸç†çš„æŒ‡é’ˆåˆ†æå’Œå¤–å½¢åˆ†æç›¸å…³è”ã€‚å½“å˜é‡ï¼ˆæˆ–è€…å¯¹è±¡ï¼‰åœ¨æ–¹æ³•ä¸­åˆ†é…åï¼Œå…¶æŒ‡é’ˆæœ‰å¯èƒ½è¢«è¿”å›æˆ–è€…è¢«å…¨å±€å¼•ç”¨ï¼Œè¿™æ ·å°±ä¼šè¢«å…¶ä»–æ–¹æ³•æˆ–è€…çº¿ç¨‹æ‰€å¼•ç”¨ï¼Œè¿™ç§ç°è±¡ç§°ä½œæŒ‡é’ˆï¼ˆæˆ–è€…å¼•ç”¨ï¼‰çš„é€ƒé€¸(Escape)ã€‚</p><p>é€šä¿—ç‚¹è®²ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«newå‡ºæ¥ä¹‹åï¼Œå®ƒå¯èƒ½è¢«å¤–éƒ¨æ‰€è°ƒç”¨ï¼Œå¦‚æœæ˜¯ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å¤–éƒ¨äº†ï¼Œå°±ç§°ä¹‹ä¸ºæ–¹æ³•é€ƒé€¸ã€‚-xx: -DoEscapeAnalysis</p><figure><img src="/panshuilong.github.io/assets/2024032210241201-418df1ca.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœå¯¹è±¡è¿˜æœ‰å¯èƒ½è¢«å¤–éƒ¨çº¿ç¨‹è®¿é—®åˆ°ï¼Œä¾‹å¦‚èµ‹å€¼ç»™å¯ä»¥åœ¨å…¶å®ƒçº¿ç¨‹ä¸­è®¿é—®çš„å®ä¾‹å˜é‡ï¼Œè¿™ç§å°±è¢«ç§°ä¸ºçº¿ç¨‹é€ƒé€¸ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> sharedObj<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sharedObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºå¹¶èµ‹å€¼ç»™å…±äº«å˜é‡</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        thread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸ</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sharedObj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é€ƒé€¸åˆ†æçš„å¥½å¤„</strong></p><ul><li>æ ˆä¸Šåˆ†é…</li></ul><p>å¦‚æœç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸ä¼šé€ƒé€¸åˆ°çº¿ç¨‹ä¹‹å¤–ï¼Œé‚£ä¹ˆä¹…å¯ä»¥è€ƒè™‘å°†è¿™ä¸ªå¯¹è±¡åœ¨æ ˆä¸Šåˆ†é…ï¼Œå¯¹è±¡å ç”¨çš„å†…å­˜éšç€æ ˆå¸§å‡ºæ ˆè€Œé”€æ¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåƒåœ¾æ”¶é›†çš„å‹åŠ›å°±é™ä½å¾ˆå¤šã€‚</p><ul><li><strong>åŒæ­¥æ¶ˆé™¤</strong></li></ul><p>çº¿ç¨‹åŒæ­¥æœ¬èº«æ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹ï¼Œå¦‚æœé€ƒé€¸åˆ†æèƒ½å¤Ÿç¡®å®šä¸€ä¸ªå˜é‡ä¸ä¼šé€ƒé€¸å‡ºçº¿ç¨‹ï¼Œæ— æ³•è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡çš„è¯»å†™è‚¯å®šå°±ä¸ä¼šæœ‰ç«äº‰ï¼Œ å¯¹è¿™ä¸ªå˜é‡å®æ–½çš„åŒæ­¥æªæ–½ä¹Ÿå°±å¯ä»¥å®‰å…¨åœ°æ¶ˆé™¤æ‰ã€‚</p><ul><li><strong>æ ‡é‡æ›¿æ¢</strong></li></ul><p>å¦‚æœä¸€ä¸ªæ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸å¯æ‹†åˆ†ï¼Œå®ƒå°±è¢«ç§°ä¹‹ä¸ºæ ‡é‡ã€‚æŠŠä¸€ä¸ªJavaå¯¹è±¡æ‹†æ•£ï¼Œå°†å…¶ç”¨åˆ°çš„æˆå‘˜å˜é‡æ¢å¤ä¸ºåŸå§‹ç±»å‹æ¥è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæ ‡é‡æ›¿æ¢ã€‚å‡å¦‚é€ƒé€¸åˆ†æèƒ½å¤Ÿè¯æ˜ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«æ–¹æ³•å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«æ‹†æ•£ï¼Œé‚£ä¹ˆå¯ä»¥ä¸åˆ›å»ºå¯¹è±¡ï¼Œç›´æ¥ç”¨åˆ›å»ºè‹¥å¹²ä¸ªæˆå‘˜å˜é‡ä»£æ›¿ï¼Œå¯ä»¥è®©å¯¹è±¡çš„æˆå‘˜å˜é‡åœ¨æ ˆä¸Šåˆ†é…å’Œè¯»å†™ã€‚</p><h2 id="_18-äº†è§£å“ªäº›æ€§jvmç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·" tabindex="-1"><a class="header-anchor" href="#_18-äº†è§£å“ªäº›æ€§jvmç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·" aria-hidden="true">#</a> 18.äº†è§£å“ªäº›æ€§JVMç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·ï¼Ÿ</h2><p>ä»¥ä¸‹æ˜¯ä¸€äº›JDKè‡ªå¸¦çš„å¯è§†åŒ–æ€§èƒ½ç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·ï¼š</p><ul><li>JConsole</li></ul><p>Jconsole æ˜¯ä¸€ä¸ª<strong>å†…ç½® Java æ€§èƒ½åˆ†æå™¨</strong>ï¼Œæ˜¯åŸºäºJava Management Extensions (JMX)çš„å®æ—¶å›¾å½¢åŒ–ç›‘æµ‹å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·åˆ©ç”¨äº†å†…å»ºåˆ°JVMé‡Œé¢çš„JMXæŒ‡ä»¤æ¥å¯¹Javaè¿›ç¨‹æä¾›å®æ—¶çš„æ€§èƒ½å’Œèµ„æºçš„ç›‘æ§ã€‚å…¶ç›‘æ§å†…å®¹åŒ…æ‹¬ï¼šå†…å­˜ã€çº¿ç¨‹ã€ç±»ã€CPUä½¿ç”¨(Javaè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ï¼Œçº¿ç¨‹çš„çŠ¶æ€ï¼Œç±»çš„ä½¿ç”¨)ç­‰ã€‚é€šè¿‡ç›‘æ§ä¿¡æ¯ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„äº†è§£åˆ°<strong>å½“å‰ç¨‹åºæ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œå¦‚å†…å­˜æ³„éœ²ã€æ­»é”ã€ç±»åŠ è½½å¼‚å¸¸ç­‰</strong>ã€‚</p><p>å¤‡æ³¨:Jconsoleç®¡ç†å†…å­˜<strong>ç›¸å½“äºå¯è§†åŒ–çš„jstatå‘½ä»¤</strong></p><figure><img src="/panshuilong.github.io/assets/2024032210311201-3b955783.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¼€å¯è¿œç¨‹ï¼š</p><p>java -jar xxx.jar</p><ul><li>-Dcom.sun.management.jmxremote è¿œç¨‹å¼€å¯å¼€å…³</li><li>-Dcom.sun.management.jmxremote.port=1808 jmxè¿œç¨‹è°ƒç”¨ç«¯å£</li><li>-Dcom.sun.management.jmxremote.authenticate=false ä¸å¼€å¯éªŒè¯</li><li>-Dcom.sun.management.jmxremote.ssl=false ä¸ä¸ºsslè¿æ¥</li><li>-Djava.rmi.server.hostname=34.126.141.21 æœåŠ¡å™¨æ‰€åœ¨ipæˆ–è€…åŸŸå</li></ul><figure><img src="/panshuilong.github.io/assets/2024032210321452-7049b71d.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>VisualVMï¼ˆjvisualvmï¼‰</li></ul><p>VisualVM æ˜¯ä¸€æ¬¾å…è´¹çš„ï¼Œé›†æˆäº†å¤šä¸ª JDK å‘½ä»¤è¡Œå·¥å…·çš„å¯è§†åŒ–å·¥å…·ï¼Œå®ƒèƒ½ä¸ºæ‚¨æä¾›å¼ºå¤§çš„åˆ†æèƒ½åŠ›ï¼Œå¯¹ <strong>Java åº”ç”¨ç¨‹åºåšæ€§èƒ½åˆ†æå’Œè°ƒä¼˜</strong>ã€‚è¿™äº›åŠŸèƒ½åŒ…æ‹¬ç”Ÿæˆå’Œ<strong>åˆ†ææµ·é‡æ•°æ®ã€è·Ÿè¸ªå†…å­˜æ³„æ¼ã€ç›‘æ§åƒåœ¾å›æ”¶å™¨ã€æ‰§è¡Œå†…å­˜å’Œ CPU åˆ†æ</strong> .</p><figure><img src="/panshuilong.github.io/assets/2024032210331203-7811e41f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p><strong>jps</strong></p></li><li><ul><li>æŸ¥çœ‹javaè¿›ç¨‹</li></ul></li><li><p><strong>jstat</strong></p></li><li><ul><li>jstatæ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼Œåœ¨æ²¡æœ‰ GUIå›¾å½¢ç•Œé¢ï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚å¸¸ç”¨å½¢å¼ï¼š</li><li>jstat [-å‘½ä»¤é€‰é¡¹] [vmid] [é—´éš”æ—¶é—´/æ¯«ç§’] [æŸ¥è¯¢æ¬¡æ•°]</li><li>å¦‚ï¼šjstat-gc 13616 100 8ï¼›</li><li>å¸¸ç”¨å‚æ•°ï¼š <ul><li><ul><li><ul><li>-class (ç±»åŠ è½½å™¨)</li><li>-compiler (JIT)</li><li>-gc (GC å †çŠ¶æ€)</li><li>-gccapacity (å„åŒºå¤§å°)</li><li>-gccause (æœ€è¿‘ä¸€æ¬¡ GC ç»Ÿè®¡å’ŒåŸå› )</li><li>-gcnew (æ–°åŒºç»Ÿè®¡)</li><li>-gcnewcapacity (æ–°åŒºå¤§å°)</li><li>-gcold (è€åŒºç»Ÿè®¡)</li><li>gcoldcapacity (è€åŒºå¤§å°)</li><li>gcpermcapacity (æ°¸ä¹…åŒºå¤§å°)</li><li>gcutil (GC ç»Ÿè®¡æ±‡æ€»)</li><li>printcompilation (HotSpot ç¼–è¯‘ç»Ÿè®¡)</li><li><ul><li></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><p>jmap</p><p>â—‹jmapç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º heapdump æˆ– dump æ–‡ä»¶ï¼‰ã€‚jmap çš„ä½œç”¨å¹¶ä¸ä»…ä»…æ˜¯ä¸ºäº†è·å– dump æ–‡ä»¶ï¼Œå®ƒè¿˜å¯ä»¥æŸ¥è¯¢ finalize æ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p><p>â– heap : æ˜¾ç¤ºJavaå †è¯¦ç»†ä¿¡æ¯</p><p>â– histo : æ˜¾ç¤ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯</p><p>â– permstat :Javaå †å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸçš„ç±»åŠ è½½å™¨çš„ç»Ÿè®¡ä¿¡æ¯</p><p>â– finalizerinfo : æ˜¾ç¤ºåœ¨F-Queueé˜Ÿåˆ—ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œ finalizeræ–¹æ³•çš„å¯¹è±¡</p><p>â– dump : ç”Ÿæˆå †è½¬å‚¨å¿«ç…§</p><div class="language-te line-numbers-mode" data-ext="te"><pre class="language-te"><code>jmap -dump:file=d:\user.hprof 1246
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>jstack</strong></li></ul><p>jstack [vmid]<br> jstackç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚<br> çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ jstack ä¸»è¦æ˜¯ç”¨æ¥æ’æŸ¥æ˜¯å¦æœ‰æ­»é”å’ŒæŸä¸ªè¿›ç¨‹çš„çº¿ç¨‹è°ƒç”¨æ ˆçš„æƒ…å†µ</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„å·¥å…·</p><ul><li><p><strong>MAT</strong>Java å †å†…å­˜åˆ†æå·¥å…·ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032210532010-bfa63499.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>GCViewer</strong> GC æ—¥å¿—åˆ†æå·¥å…·ã€‚</p><figure><img src="/panshuilong.github.io/assets/5bb16b0a0001e4a510240541-a824ba15.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>arthas</strong>é˜¿é‡Œå¼€æºè¯Šæ–­å·¥å…·ã€‚</p></li></ul><h2 id="_19-jvmçš„å¸¸è§å‚æ•°é…ç½®çŸ¥é“å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_19-jvmçš„å¸¸è§å‚æ•°é…ç½®çŸ¥é“å“ªäº›" aria-hidden="true">#</a> 19.JVMçš„å¸¸è§å‚æ•°é…ç½®çŸ¥é“å“ªäº›ï¼Ÿ</h2><ul><li><p>å‚æ•°1 ï¼š -Xmx å’Œ â€“Xms</p><p>-Xmxå‚æ•°è®¾ç½®çš„æ˜¯æœ€å¤§å †å†…å­˜ï¼Œä½†æ˜¯ç”±äºç¨‹åºæ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨æˆ–è€…å®¹å™¨ä¸Šï¼Œè®¡ç®—å¯ç”¨å†…å­˜æ—¶ï¼Œè¦å°†å…ƒç©ºé—´ã€æ“ä½œç³»ç»Ÿã€ å…¶å®ƒè½¯ä»¶å ç”¨çš„å†…å­˜æ’é™¤æ‰ã€‚</p><p>æ¡ˆä¾‹ï¼š æœåŠ¡å™¨å†…å­˜4Gï¼Œæ“ä½œç³»ç»Ÿ+å…ƒç©ºé—´æœ€å¤§å€¼+å…¶å®ƒè½¯ä»¶å ç”¨1.5Gï¼Œ-Xmxå¯ä»¥è®¾ç½®ä¸º2gã€‚</p><p>æœ€åˆç†çš„è®¾ç½®æ–¹å¼åº”è¯¥æ˜¯æ ¹æ®æœ€å¤§å¹¶å‘é‡ä¼°ç®—æœåŠ¡å™¨çš„é…ç½®ï¼Œç„¶åå†æ ¹æ®æœåŠ¡å™¨é…ç½®è®¡ç®—æœ€å¤§å †å†…å­˜çš„å€¼ã€‚</p><p>å»ºè®®å°†-Xmsè®¾ç½®çš„å’Œ-Xmxä¸€æ ·å¤§,è¿è¡Œè¿‡ç¨‹ä¸­ä¸å†äº§ç”Ÿæ‰©å®¹çš„å¼€é”€ã€‚</p></li><li><p>å‚æ•°2 ï¼š -XX:MaxMetaspaceSize å’Œ -Xss</p><p>-XX:MaxMetaspaceSize=å€¼ å‚æ•°æŒ‡çš„æ˜¯æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼Œé»˜è®¤å€¼æ¯”è¾ƒå¤§ï¼Œå¦‚æœå‡ºç°å…ƒç©ºé—´å†…å­˜æ³„æ¼ä¼šè®©æ“ä½œç³» ç»Ÿå¯ç”¨å†…å­˜ä¸å¯æ§ï¼Œå»ºè®®æ ¹æ®æµ‹è¯•æƒ…å†µè®¾ç½®æœ€å¤§å€¼ï¼Œä¸€èˆ¬è®¾ç½®ä¸º256mã€‚</p><p>-Xss256k æ ˆå†…å­˜å¤§å°ï¼Œå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šæ ˆçš„å¤§å°ï¼ŒJVM å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰é»˜è®¤å¤§å°çš„æ ˆã€‚å¤§å°å–å†³äºæ“ä½œç³»ç»Ÿå’Œè®¡ ç®—æœºçš„ä½“ç³»ç»“æ„ã€‚æ¯”å¦‚Linux x86 64ä½ ï¼š 1MBï¼Œå¦‚æœä¸éœ€è¦ç”¨åˆ°è¿™ä¹ˆå¤§çš„æ ˆå†…å­˜ï¼Œå®Œå…¨å¯ä»¥å°†æ­¤å€¼è°ƒå°èŠ‚çœå†…å­˜ ç©ºé—´ï¼Œåˆç†å€¼ä¸º256k â€“ 1mä¹‹é—´ã€‚</p></li><li><p>å‚æ•°3ï¼š -Xmn</p><p>-Xmn å¹´è½»ä»£çš„å¤§å°ï¼Œé»˜è®¤å€¼ä¸ºæ•´ä¸ªå †çš„1/3ï¼Œå¯ä»¥æ ¹æ®å³°å€¼æµé‡è®¡ç®—æœ€å¤§çš„å¹´è½»ä»£å¤§å°ï¼Œå°½é‡è®©å¯¹è±¡åªå­˜æ”¾åœ¨å¹´ è½»ä»£ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚ä½†æ˜¯å®é™…çš„åœºæ™¯ä¸­ï¼Œæ¥å£çš„å“åº”æ—¶é—´ã€åˆ›å»ºå¯¹è±¡çš„å¤§å°ã€ç¨‹åºå†…éƒ¨è¿˜ä¼šæœ‰ä¸€äº›å®šæ—¶ä»»åŠ¡ç­‰ä¸ ç¡®å®šå› ç´ éƒ½ä¼šå¯¼è‡´è¿™ä¸ªå€¼çš„å¤§å°å¹¶ä¸èƒ½ä»…å‡­è®¡ç®—å¾—å‡ºï¼Œå¦‚æœè®¾ç½®è¯¥å€¼è¦è¿›è¡Œå¤§é‡çš„æµ‹è¯•ã€‚G1åƒåœ¾å›æ”¶å™¨å°½é‡ä¸è¦è®¾ ç½®è¯¥å€¼ï¼ŒG1ä¼šåŠ¨æ€è°ƒæ•´å¹´è½»ä»£çš„å¤§å°ã€‚</p></li><li><p>æ‰“å°GCæ—¥å¿—</p><p>JDK8åŠä¹‹å‰ ï¼š -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:æ–‡ä»¶è·¯å¾„</p><p>JDK9åŠä¹‹å ï¼š -Xlog:gc*:file=æ–‡ä»¶è·¯å¾„</p></li><li><p>-XX:+DisableExplicitGC</p><p>ç¦æ­¢åœ¨ä»£ç ä¸­ä½¿ç”¨System.gc()ï¼Œ System.gc()å¯èƒ½ä¼šå¼•èµ·FULLGCï¼Œåœ¨ä»£ç ä¸­å°½é‡ä¸è¦ä½¿ç”¨ã€‚ä½¿ç”¨ DisableExplicitGCå‚æ•°å¯ä»¥ç¦æ­¢ä½¿ç”¨System.gc()æ–¹æ³•è°ƒç”¨ã€‚</p></li><li><p>-XX:+HeapDumpOnOutOfMemoryErrorï¼šå‘ç”ŸOutOfMemoryErroré”™è¯¯æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆhprofå†…å­˜å¿«ç…§æ–‡ä»¶ã€‚ -XX:HeapDumpPath=ï¼šæŒ‡å®šhprofæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚</p></li></ul><p>JVMå‚æ•°æ¨¡æ¿ï¼š</p><table><thead><tr><th>-Xms1g</th><th>åˆå§‹å †å†…å­˜1g</th></tr></thead><tbody><tr><td>-Xmx1g</td><td>æœ€å¤§å †å†…å­˜1g</td></tr><tr><td>-Xss256k</td><td>æ¯ä¸ªçº¿ç¨‹çš„æ ˆå†…å­˜æœ€å¤§256k</td></tr><tr><td>-XX:MaxMetaspaceSize=512m</td><td>æœ€å¤§å…ƒç©ºé—´å¤§å°512m</td></tr><tr><td>-XX:+DisableExplicitGC</td><td>ä»£ç ä¸­System.gc()æ— æ•ˆ</td></tr><tr><td>-XX:+HeapDumpOnOutOfMemoryError</td><td>OutOfMemoryé”™è¯¯æ—¶ç”Ÿæˆå †å†…å­˜å¿«ç…§</td></tr><tr><td>-XX:HeapDumpPath=/opt/dumps/my-service.hprof</td><td>å †å†…å­˜å¿«ç…§ç”Ÿæˆä½ç½®</td></tr><tr><td>-XX:+PrintGCDetails</td><td>æ‰“å°è¯¦ç»†åƒåœ¾å›æ”¶æ—¥å¿—</td></tr><tr><td>-XX:+PrintGCDateStamps</td><td>æ‰“å°åƒåœ¾å›æ”¶æ—¶é—´</td></tr><tr><td>-Xloggc:æ–‡ä»¶è·¯å¾„</td><td>æ—¥å¿—æ–‡ä»¶è¾“å‡ºä½ç½®</td></tr></tbody></table><p>æ³¨æ„ï¼š JDK9åŠä¹‹ågcæ—¥å¿—è¾“å‡ºä¿®æ”¹ä¸º -Xlog:gc*:file=æ–‡ä»¶å</p><p>å †å†…å­˜å¤§å°å’Œæ ˆå†…å­˜å¤§å°æ ¹æ®å®é™…æƒ…å†µçµæ´»è°ƒæ•´ã€‚</p><h2 id="_20-æœ‰æ²¡æœ‰è¿›è¡Œè¿‡jvmè°ƒä¼˜-è¯´è¯´ä½ çš„è°ƒä¼˜æ€è·¯" tabindex="-1"><a class="header-anchor" href="#_20-æœ‰æ²¡æœ‰è¿›è¡Œè¿‡jvmè°ƒä¼˜-è¯´è¯´ä½ çš„è°ƒä¼˜æ€è·¯" aria-hidden="true">#</a> 20.æœ‰æ²¡æœ‰è¿›è¡Œè¿‡JVMè°ƒä¼˜ï¼Œè¯´è¯´ä½ çš„è°ƒä¼˜æ€è·¯ï¼Ÿ</h2><p><strong>ä¸ºä»€ä¹ˆè¦è°ƒä¼˜</strong></p><ul><li>é˜²æ­¢å‡ºç°OOM</li><li>è§£å†³OOM</li><li>å‡å°‘Full GCå‡ºç°çš„é¢‘ç‡</li></ul><p>å‰é¢é“ºå«äº†å¾ˆå¤šJVMçš„åŸºç¡€çŸ¥è¯†ï¼Œè¿™ä¸€è®²æˆ‘ä»¬ç»ˆäºæ¥åˆ°äº†JVMè°ƒä¼˜è¯¾é¢˜ã€‚JVMè°ƒä¼˜æ˜¯ä¸€ä¸ªæ‰‹æ®µï¼Œä½†å¹¶ä¸ä¸€å®šæ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥é€šè¿‡JVMè¿›è¡Œè°ƒä¼˜è§£å†³ï¼Œå› æ­¤ï¼Œåœ¨è¿›è¡ŒJVMè°ƒä¼˜æ—¶ï¼Œæˆ‘ä»¬è¦éµå¾ªä¸€äº›åŸåˆ™ï¼š</p><ul><li>å¤§å¤šæ•°çš„Javaåº”ç”¨ä¸éœ€è¦è¿›è¡ŒJVMä¼˜åŒ–ï¼›</li><li>å¤§å¤šæ•°å¯¼è‡´GCé—®é¢˜çš„åŸå› æ˜¯ä»£ç å±‚é¢çš„é—®é¢˜å¯¼è‡´çš„ï¼ˆä»£ç å±‚é¢ï¼‰ï¼›</li><li>ä¸Šçº¿ä¹‹å‰ï¼Œåº”å…ˆè€ƒè™‘å°†æœºå™¨çš„JVMå‚æ•°è®¾ç½®åˆ°æœ€ä¼˜ï¼›</li><li>å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼ˆä»£ç å±‚é¢ï¼‰ï¼›</li><li>å‡å°‘ä½¿ç”¨å…¨å±€å˜é‡å’Œå¤§å¯¹è±¡ï¼ˆä»£ç å±‚é¢ï¼‰ï¼›</li><li>ä¼˜å…ˆæ¶æ„è°ƒä¼˜å’Œä»£ç è°ƒä¼˜ï¼ŒJVMä¼˜åŒ–æ˜¯ä¸å¾—å·²çš„æ‰‹æ®µï¼ˆä»£ç ã€æ¶æ„å±‚é¢ï¼‰ï¼›</li><li>åˆ†æGCæƒ…å†µä¼˜åŒ–ä»£ç æ¯”ä¼˜åŒ–JVMå‚æ•°æ›´å¥½ï¼ˆä»£ç å±‚é¢ï¼‰ï¼›</li></ul><p>é€šè¿‡ä»¥ä¸ŠåŸåˆ™ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå…¶å®æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ‰‹æ®µæ˜¯æ¶æ„å’Œä»£ç å±‚é¢çš„ä¼˜åŒ–ï¼Œè€ŒJVMä¼˜åŒ–åˆ™æ˜¯æœ€åä¸å¾—å·²çš„æ‰‹æ®µï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å¯¹æœåŠ¡å™¨é…ç½®çš„æœ€åä¸€æ¬¡â€œå‹æ¦¨â€ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•è¿›è¡ŒJVMè°ƒä¼˜ï¼Œè°ƒä¼˜ä¸æ˜¯ç›²ç›®çš„ï¼Œæˆ‘ä»¬æ¯ä¿®æ”¹ä¸€ä¸ªJVMéƒ½æœ‰å®ƒèƒŒåçš„è€ƒç©¶å’Œæ•°æ®æ”¯æ’‘ã€‚åœ¨è¿™é‡Œåˆ†äº«ç»™å¤§å®¶ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„JVMè°ƒä¼˜çš„æ­¥éª¤ â¬‡ï¸</p><h3 id="jvmè°ƒä¼˜çš„ä¸€èˆ¬æ­¥éª¤ä¸º" tabindex="-1"><a class="header-anchor" href="#jvmè°ƒä¼˜çš„ä¸€èˆ¬æ­¥éª¤ä¸º" aria-hidden="true">#</a> JVMè°ƒä¼˜çš„ä¸€èˆ¬æ­¥éª¤ä¸ºï¼š</h3><ul><li>ç¬¬1æ­¥ï¼šåˆ†æGCæ—¥å¿—åŠdumpæ–‡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–ï¼Œç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹ï¼›</li><li>ç¬¬2æ­¥ï¼šç¡®å®šJVMè°ƒä¼˜é‡åŒ–ç›®æ ‡ï¼›</li><li>ç¬¬3æ­¥ï¼šç¡®å®šJVMè°ƒä¼˜å‚æ•°ï¼ˆæ ¹æ®å†å²JVMå‚æ•°æ¥è°ƒæ•´ï¼‰ï¼›</li><li>ç¬¬4æ­¥ï¼šè°ƒä¼˜ä¸€å°æœåŠ¡å™¨ï¼Œå¯¹æ¯”è§‚å¯Ÿè°ƒä¼˜å‰åçš„å·®å¼‚ï¼›</li><li>ç¬¬5æ­¥ï¼šä¸æ–­çš„åˆ†æå’Œè°ƒæ•´ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„JVMå‚æ•°é…ç½®ï¼›</li><li>ç¬¬6æ­¥ï¼šæ‰¾åˆ°æœ€åˆé€‚çš„å‚æ•°ï¼Œå°†è¿™äº›å‚æ•°åº”ç”¨åˆ°æ‰€æœ‰æœåŠ¡å™¨ï¼Œå¹¶è¿›è¡Œåç»­è·Ÿè¸ªã€‚</li></ul><h3 id="åˆ†ægcæ—¥å¿—åŠdumpæ–‡ä»¶-åˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–-ç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#åˆ†ægcæ—¥å¿—åŠdumpæ–‡ä»¶-åˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–-ç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹" aria-hidden="true">#</a> åˆ†æGCæ—¥å¿—åŠdumpæ–‡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–ï¼Œç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹</h3><p>å‰é¢æåˆ°æ¯ä¸€ä¸ªå‚æ•°çš„ä¿®æ”¹éƒ½æœ‰å®ƒèƒŒåçš„æ•°æ®åšæ”¯æ’‘ã€‚é‚£æ•°æ®æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿå°±æ˜¯ä»æˆ‘ä»¬<code>GC</code>æ—¥å¿—å’Œ<code>dump</code>æ–‡ä»¶ä¸­åˆ†æå‡ºæ¥çš„ã€‚è¿™ä¸€è®²æˆ‘ä»¬å°±æ¥ä»”ç»†èŠä¸€èŠæˆ‘ä»¬é€šè¿‡ä»€ä¹ˆå·¥å…·å»æŸ¥çœ‹GCæ—¥å¿—å’Œdumpæ–‡ä»¶ï¼Œå¦‚ä½•å»åˆ†æGCæ—¥å¿—å’Œdumpæ–‡ä»¶å»æ‰¾å‡ºç—‡èŠ‚æ‰€åœ¨ã€‚</p><h4 id="gcæ—¥å¿—åˆ†æ" tabindex="-1"><a class="header-anchor" href="#gcæ—¥å¿—åˆ†æ" aria-hidden="true">#</a> GCæ—¥å¿—åˆ†æ</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹GCæ—¥å¿—åˆ†æï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦éƒ½æ²¡çœ‹åˆ°è¿‡GCæ—¥å¿—ï¼ŒGCæ—¥å¿—è®°å½•äº†åƒåœ¾æ”¶é›†å™¨çš„è¿è¡Œæƒ…å†µï¼ŒåŒ…æ‹¬åƒåœ¾å›æ”¶çš„åŸå› ã€æ—¶é—´ã€æ‰§è¡Œçš„çº¿ç¨‹ã€å›æ”¶çš„å†…å­˜ç©ºé—´ç­‰ä¿¡æ¯ã€‚å®ƒä¸»è¦ç”¨äºåˆ†æåƒåœ¾æ”¶é›†å™¨çš„æ€§èƒ½å’Œè°ƒä¼˜ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å…ˆæ¥é“ºå«ä¸€ä¸‹æˆ‘ä»¬çš„å·¥ç¨‹æ˜¯å¦‚ä½•è·å–åˆ°GCæ—¥å¿—çš„ï¼Œç„¶åæˆ‘ä»¬åœ¨å»è®²å·¥å…·è®²åˆ†æã€‚è¿™é‡Œæˆ‘ä»¬ä»¥Javaç¨‹åºã€Tomcaté¡¹ç›®ã€SpringBooté¡¹ç›®æ¥è®²è§£ã€‚</p><p><strong>Javaç¨‹åº</strong></p><p>Javaç¨‹åºå¯ä»¥é€šè¿‡åœ¨å¯åŠ¨å‚æ•°ä¸­æ·»åŠ ç›¸åº”çš„å‚æ•°æ¥å¼€å¯GCæ—¥å¿—çš„è®°å½•ã€‚å…·ä½“è€Œè¨€ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li>-XX:+PrintGCï¼šå¼€å¯GCæ—¥å¿—è¾“å‡ºï¼›</li><li>-XX:+PrintGCDetailsï¼šåœ¨GCæ—¥å¿—ä¸­è¾“å‡ºè¯¦ç»†çš„ä¿¡æ¯ï¼›</li><li>-XX:+PrintGCDateStampsï¼šåœ¨GCæ—¥å¿—ä¸­è¾“å‡ºæ—¶é—´æˆ³ï¼›</li><li>-Xlog:gc+heap=traceï¼šåœ¨GCå‰åè¾“å‡ºå †çš„è¯¦ç»†ä¿¡æ¯ï¼›</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-Xlog:gc:&lt;filename&gt;ï¼šå°†GCæ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åŸºäºJava17ç‰ˆæœ¬ï¼š</p><p>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨Javaç¨‹åºï¼Œå¹¶è¾“å‡ºGCæ—¥å¿—åˆ°æ–‡ä»¶gc.logä¸­ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token parameter variable">-Xms5M</span> <span class="token parameter variable">-Xmx5M</span> -Xlog:gc:/Users/a123/IdeaProjects/java-example/logs/gc.log <span class="token parameter variable">-XX:+PrintGC</span> -Xlog:gc+heap<span class="token operator">=</span>trace
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒGCæ—¥å¿—ä¼šè¢«è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡åˆ†ææ—¥å¿—æ¥äº†è§£åƒåœ¾æ”¶é›†çš„æƒ…å†µï¼Œè¿›è€Œè¿›è¡Œä¼˜åŒ–å’Œè°ƒä¼˜ã€‚</p><p><strong>Tomcat</strong></p><p>å¯¹äºTomcaté¡¹ç›®ï¼Œå¯ä»¥åœ¨Tomcatå¯åŠ¨è„šæœ¬ä¸­çš„JAVA_OPTSå˜é‡ä¸­æ·»åŠ ç›¸åº”çš„å‚æ•°æ¥å¼€å¯GCæ—¥å¿—çš„è®°å½•ã€‚å…·ä½“è€Œè¨€ï¼Œå¯ä»¥ä¿®æ”¹catalina.shæˆ–catalina.batï¼ˆWindowsä¸‹ï¼‰æ–‡ä»¶ï¼ŒåŠ å…¥å¦‚ä¸‹å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xloggc:/path/to/gc.log -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintHeapAtGC&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œ/path/to/gc.logä¸ºæŒ‡å®šçš„æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„ã€‚</p><p><strong>SpringBoot</strong></p><p>å¯¹äºSpring Booté¡¹ç›®ï¼Œå¯ä»¥åœ¨application.propertiesæˆ–application.ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å‚æ•°ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">logging.file</span><span class="token punctuation">=</span><span class="token value attr-value">gc.log</span>
<span class="token key attr-name">logging.level.gc</span><span class="token punctuation">=</span><span class="token value attr-value">info</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œlogging.fileæŒ‡å®šæ—¥å¿—æ–‡ä»¶åï¼Œlogging.level.gcæŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œè¿™é‡Œè®¾ç½®ä¸ºinfoä»¥è¾“å‡ºGCæ—¥å¿—ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒç‰ˆæœ¬çš„Tomcatå’ŒSpring Bootå¯èƒ½ä¼šæœ‰æ‰€å·®å¼‚ï¼Œå…·ä½“æ·»åŠ å‚æ•°çš„æ–¹å¼å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥æŸ¥é˜…å¯¹åº”ç‰ˆæœ¬çš„æ–‡æ¡£æˆ–æ‰‹å†Œï¼Œäº†è§£å¦‚ä½•æ­£ç¡®åœ°å¼€å¯GCæ—¥å¿—è®°å½•ã€‚</p><p>æˆ‘ä»¬ç®€å•çš„æ¥çœ‹ä¸€ä¸‹GCæ—¥å¿—ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.554+0800<span class="token punctuation">]</span> <span class="token parameter variable">-XX:+PrintGC</span> is deprecated. Will use <span class="token parameter variable">-Xlog:gc</span> instead.
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.557+0800<span class="token punctuation">]</span> Using G1
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.593+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Evacuation Pause<span class="token punctuation">)</span> 3M-<span class="token operator">&gt;</span>3M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">1</span>.720ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.596+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Concurrent Start<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Preventive Collection<span class="token punctuation">)</span> 4M-<span class="token operator">&gt;</span>3M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">1</span>.533ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.596+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> Concurrent Mark Cycle
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.598+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Preventive Collection<span class="token punctuation">)</span> 4M-<span class="token operator">&gt;</span>4M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">1</span>.069ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.601+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> To-space exhausted
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.601+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Preventive Collection<span class="token punctuation">)</span> 5M-<span class="token operator">&gt;</span>5M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">2</span>.454ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.606+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> To-space exhausted
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.606+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Evacuation Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">4</span>.494ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.617+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> Pause Full <span class="token punctuation">(</span>G1 Compaction Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">10</span>.797ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.627+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> Pause Full <span class="token punctuation">(</span>G1 Compaction Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">10</span>.258ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.627+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> Concurrent Mark Cycle <span class="token number">31</span>.610ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.628+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Normal<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Evacuation Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">0</span>.243ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.636+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> Pause Full <span class="token punctuation">(</span>G1 Compaction Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">8</span>.079ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.646+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> Pause Full <span class="token punctuation">(</span>G1 Compaction Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">10</span>.570ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.647+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> Pause Young <span class="token punctuation">(</span>Concurrent Start<span class="token punctuation">)</span> <span class="token punctuation">(</span>G1 Evacuation Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>6M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">0</span>.307ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.647+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> Concurrent Mark Cycle
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.648+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> Pause Full <span class="token punctuation">(</span>G1 Compaction Pause<span class="token punctuation">)</span> 6M-<span class="token operator">&gt;</span>1M<span class="token punctuation">(</span>8M<span class="token punctuation">)</span> <span class="token number">1</span>.330ms
<span class="token punctuation">[</span><span class="token number">2023</span>-02-14T22:13:12.648+0800<span class="token punctuation">]</span> GC<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> Concurrent Mark Cycle <span class="token number">1</span>.388ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ—¥å¿—æ–‡ä»¶ç›´æ¥çœ‹èµ·æ¥ä¸æ˜¯ä¸æ˜¯å¾ˆç›´è§‚çœ‹èµ·æ¥æ¯”è¾ƒè´¹åŠ²ã€‚äº‹å®ä¸Šåˆ†æGCæ—¥å¿—å¯è§†åŒ–çš„å·¥å…·å¾ˆå¤šå¾ˆå¤šï¼Œè¿™é‡Œæ•´ç†äº†ä¸€ä»½ï¼š</p><ul><li>GCViewerï¼šåŠŸèƒ½ç®€å•ã€æ˜“äºä½¿ç”¨ï¼Œé€‚åˆåˆå­¦è€…ã€‚</li><li>GCEasyï¼šè‡ªåŠ¨æ£€æµ‹GCæ—¥å¿—ï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—çš„æŠ¥å‘Šå’Œå»ºè®®ï¼Œé€‚åˆå¿«é€Ÿå®šä½å’Œè§£å†³GCé—®é¢˜ã€‚</li><li>HPROFï¼šJavaè‡ªå¸¦çš„å †å†…å­˜åˆ†æå·¥å…·ï¼Œå¯ä»¥ä¸GCViewerç­‰å·¥å…·ç»“åˆä½¿ç”¨ï¼Œæä¾›æ›´å…¨é¢çš„åˆ†æã€‚</li><li>Java Mission Controlï¼šJDKè‡ªå¸¦çš„æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œæä¾›äº†åŒ…æ‹¬GCåœ¨å†…çš„å¤šç§ç›‘æ§æŒ‡æ ‡ï¼Œå¹¶èƒ½ä¸VisualVMç­‰å·¥å…·é›†æˆä½¿ç”¨ã€‚</li><li>VisualVMï¼šåŠŸèƒ½å…¨é¢ã€æ’ä»¶ä¸°å¯Œï¼Œæ”¯æŒå¤šç§ç›‘æ§æŒ‡æ ‡å’Œåˆ†ææ–¹å¼ï¼Œé€‚åˆé«˜çº§ç”¨æˆ·å’Œä¸“ä¸šäººå£«ã€‚</li><li>GClogAnalyzerï¼šæä¾›äº†å¤šç§å›¾è¡¨å’Œåˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿæ·±å…¥åˆ†æGCæ—¥å¿—çš„å„ä¸ªæ–¹é¢ã€‚</li><li>YourKit Java Profilerï¼šåŠŸèƒ½ä¸°å¯Œã€æ˜“äºä½¿ç”¨ï¼Œæä¾›äº†GCåˆ†æã€CPUåˆ†æã€å†…å­˜åˆ†æç­‰å¤šç§åŠŸèƒ½ï¼Œé€‚åˆä¸“ä¸šäººå£«ä½¿ç”¨ã€‚</li><li>JProfilerï¼šæä¾›äº†å¤šç§æ€§èƒ½åˆ†æå’Œè°ƒè¯•å·¥å…·ï¼ŒåŒ…æ‹¬GCåˆ†æã€CPUåˆ†æã€å†…å­˜åˆ†æç­‰ï¼Œé€‚åˆä¸“ä¸šäººå£«ä½¿ç”¨ã€‚</li></ul><p>åœ¨æ­¤æˆ‘ä»¬åŸºäºGCEasyæ¥è¿›è¡ŒGCæ—¥å¿—åˆ†æã€‚</p><p>å®˜ç½‘åœ°å€ä¸ºï¼š<a href="https://gceasy.io/" target="_blank" rel="noopener noreferrer">https://gceasy.io/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å®ƒæœ‰åœ¨çº¿åˆ†æç‰ˆå’Œç¦»çº¿åˆ†æç‰ˆéƒ½å¯ä»¥ä½¿ç”¨</p><figure><img src="/panshuilong.github.io/assets/2024032211141201-39b05b95.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="/panshuilong.github.io/assets/2024023311141520-8dcb3278.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æŸ¥çœ‹å½“å‰æ—¥å¿—ï¼Œåˆ†æå½“å‰JVMå‚æ•°è®¾ç½®ï¼Œå¹¶ä¸”åˆ†æå½“å‰å †å†…å­˜å¿«ç…§å’Œgcæ—¥å¿—ï¼Œæ ¹æ®å®é™…çš„å„åŒºåŸŸå†…å­˜åˆ’åˆ†å’ŒGCæ‰§è¡Œæ—¶é—´ï¼Œè§‰å¾—æ˜¯å¦è¿›è¡Œä¼˜åŒ–ã€‚</p><p><strong>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š ç³»ç»Ÿå´©æºƒå‰çš„ä¸€äº›ç°è±¡ï¼š</strong></p><ul><li>æ¯æ¬¡åƒåœ¾å›æ”¶çš„æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œç”±ä¹‹å‰çš„10mså»¶é•¿åˆ°50mså·¦å³ï¼ŒFullGCçš„æ—¶é—´ä¹Ÿæœ‰ä¹‹å‰çš„0.5så»¶é•¿åˆ°4ã€5s</li><li>FullGCçš„æ¬¡æ•°è¶Šæ¥è¶Šå¤šï¼Œæœ€é¢‘ç¹æ—¶éš”ä¸åˆ°1åˆ†é’Ÿå°±è¿›è¡Œä¸€æ¬¡FullGC</li><li>å¹´è€ä»£çš„å†…å­˜è¶Šæ¥è¶Šå¤§å¹¶ä¸”æ¯æ¬¡FullGCåå¹´è€ä»£æ²¡æœ‰å†…å­˜è¢«é‡Šæ”¾</li></ul><p>ä¹‹åç³»ç»Ÿä¼šæ— æ³•å“åº”æ–°çš„è¯·æ±‚ï¼Œé€æ¸åˆ°è¾¾OutOfMemoryErrorçš„ä¸´ç•Œå€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ†æJVMå†…å­˜å¿«ç…§dumpã€‚</p><h4 id="dumpæ–‡ä»¶åˆ†æ" tabindex="-1"><a class="header-anchor" href="#dumpæ–‡ä»¶åˆ†æ" aria-hidden="true">#</a> dumpæ–‡ä»¶åˆ†æ</h4><p>è®²å®Œäº†æˆ‘ä»¬çš„GCæ—¥å¿—åˆ†æï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æˆ‘ä»¬çš„dumpæ–‡ä»¶åˆ†æï¼Œdumpæ–‡ä»¶è®°å½•äº†Javaè™šæ‹Ÿæœºåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬Javaè™šæ‹Ÿæœºè¿›ç¨‹çš„å †æ ˆä¿¡æ¯ã€Javaå¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ã€çº¿ç¨‹ä¿¡æ¯ã€ç±»ä¿¡æ¯ç­‰ã€‚å®ƒä¸»è¦ç”¨äºåˆ†æJavaè™šæ‹Ÿæœºçš„çŠ¶æ€ã€è¯Šæ–­å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚GCæ—¥å¿—é€‚åˆç”¨äºè°ƒä¼˜åƒåœ¾æ”¶é›†å™¨ï¼Œè€Œdumpæ–‡ä»¶é€‚åˆç”¨äºåˆ†æJavaè™šæ‹Ÿæœºçš„çŠ¶æ€ä¿¡æ¯ã€‚</p><p><strong>åˆ†æç»“æœï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–</strong></p><p>å¦‚æœå„é¡¹å‚æ•°è®¾ç½®åˆç†ï¼Œç³»ç»Ÿæ²¡æœ‰è¶…æ—¶æ—¥å¿—å‡ºç°ï¼ŒGCé¢‘ç‡ä¸é«˜ï¼ŒGCè€—æ—¶ä¸é«˜ï¼Œé‚£ä¹ˆæ²¡æœ‰å¿…è¦è¿›è¡ŒGCä¼˜åŒ–ï¼Œå¦‚æœGCæ—¶é—´è¶…è¿‡1-3ç§’ï¼Œæˆ–è€…é¢‘ç¹GCï¼Œåˆ™å¿…é¡»ä¼˜åŒ–ã€‚</p><p><strong>å¦‚æœæ»¡è¶³ä¸‹é¢çš„æŒ‡æ ‡ï¼Œåˆ™ä¸€èˆ¬ä¸éœ€è¦è¿›è¡ŒGCï¼š</strong></p><ul><li>Minor GCæ‰§è¡Œæ—¶é—´ä¸åˆ°50msï¼›</li><li>Minor GCæ‰§è¡Œä¸é¢‘ç¹ï¼Œçº¦10ç§’ä¸€æ¬¡ï¼›</li><li>Full GCæ‰§è¡Œæ—¶é—´ä¸åˆ°1sï¼›</li><li>Full GCæ‰§è¡Œé¢‘ç‡ä¸ç®—é¢‘ç¹ï¼Œä¸ä½äº10åˆ†é’Ÿ1æ¬¡ï¼›</li></ul><p><strong>è°ƒæ•´GCç±»å‹å’Œå†…å­˜åˆ†é…</strong></p><p>å¦‚æœå†…å­˜åˆ†é…è¿‡å¤§æˆ–è¿‡å°ï¼Œæˆ–è€…é‡‡ç”¨çš„GCæ”¶é›†å™¨æ¯”è¾ƒæ…¢ï¼Œåˆ™åº”è¯¥ä¼˜å…ˆè°ƒæ•´è¿™äº›å‚æ•°ï¼Œå¹¶ä¸”å…ˆæ‰¾1å°æˆ–å‡ å°æœºå™¨è¿›è¡Œbetaï¼Œç„¶åæ¯”è¾ƒä¼˜åŒ–è¿‡çš„æœºå™¨å’Œæ²¡æœ‰ä¼˜åŒ–çš„æœºå™¨çš„æ€§èƒ½å¯¹æ¯”ï¼Œå¹¶æœ‰é’ˆå¯¹æ€§çš„åšå‡ºæœ€åé€‰æ‹©ã€‚</p><p><strong>ä¸æ–­çš„åˆ†æå’Œè°ƒæ•´</strong></p><p>é€šè¿‡ä¸æ–­çš„è¯•éªŒå’Œè¯•é”™ï¼Œåˆ†æå¹¶æ‰¾åˆ°æœ€åˆé€‚çš„å‚æ•°ï¼Œå¦‚æœæ‰¾åˆ°äº†æœ€åˆé€‚çš„å‚æ•°ï¼Œåˆ™å°†è¿™äº›<strong>å‚æ•°åº”ç”¨åˆ°æ‰€æœ‰æœåŠ¡å™¨ã€‚</strong></p><h3 id="æœ‰ç”¨è¿‡å“ªäº›jvmè°ƒä¼˜å‚æ•°å—" tabindex="-1"><a class="header-anchor" href="#æœ‰ç”¨è¿‡å“ªäº›jvmè°ƒä¼˜å‚æ•°å—" aria-hidden="true">#</a> æœ‰ç”¨è¿‡å“ªäº›JVMè°ƒä¼˜å‚æ•°å—ï¼Ÿ</h3><p>1.é’ˆå¯¹JVMå †çš„è®¾ç½®ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡-Xms -Xmxé™å®šå…¶æœ€å°ã€æœ€å¤§å€¼ï¼Œ<strong>ä¸ºäº†é˜²æ­¢åƒåœ¾æ”¶é›†å™¨åœ¨æœ€å°ã€æœ€å¤§ä¹‹é—´æ”¶ç¼©å †è€Œäº§ç”Ÿé¢å¤–çš„æ—¶é—´ï¼Œé€šå¸¸æŠŠæœ€å¤§ã€æœ€å°è®¾ç½®ä¸ºç›¸åŒçš„å€¼;</strong></p><p><strong>2.å¹´è½»ä»£å’Œå¹´è€ä»£å°†æ ¹æ®é»˜è®¤çš„æ¯”ä¾‹ï¼ˆ1ï¼š2ï¼‰åˆ†é…å †å†…å­˜</strong>ï¼Œ å¯ä»¥é€šè¿‡è°ƒæ•´äºŒè€…ä¹‹é—´çš„æ¯”ç‡NewRadioæ¥è°ƒæ•´äºŒè€…ä¹‹é—´çš„å¤§å°ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹å›æ”¶ä»£ã€‚</p><p>æ¯”å¦‚å¹´è½»ä»£ï¼Œé€šè¿‡ -XX:newSize -XX:MaxNewSizeæ¥è®¾ç½®å…¶ç»å¯¹å¤§å°ã€‚åŒæ ·ï¼Œä¸ºäº†é˜²æ­¢å¹´è½»ä»£çš„å †æ”¶ç¼©ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠŠ-XX:newSize -XX:MaxNewSizeè®¾ç½®ä¸ºåŒæ ·å¤§å°ã€‚</p><p>3.å¹´è½»ä»£å’Œå¹´è€ä»£è®¾ç½®å¤šå¤§æ‰ç®—åˆç†</p><p><strong>1ï¼‰æ›´å¤§çš„å¹´è½»ä»£å¿…ç„¶å¯¼è‡´æ›´å°çš„å¹´è€ä»£ï¼Œå¤§çš„å¹´è½»ä»£ä¼šå»¶é•¿æ™®é€šGCçš„å‘¨æœŸï¼Œä½†ä¼šå¢åŠ æ¯æ¬¡GCçš„æ—¶é—´ï¼›å°çš„å¹´è€ä»£ä¼šå¯¼è‡´æ›´é¢‘ç¹çš„Full GC</strong></p><p><strong>2ï¼‰æ›´å°çš„å¹´è½»ä»£å¿…ç„¶å¯¼è‡´æ›´å¤§å¹´è€ä»£ï¼Œå°çš„å¹´è½»ä»£ä¼šå¯¼è‡´æ™®é€šGCå¾ˆé¢‘ç¹ï¼Œä½†æ¯æ¬¡çš„GCæ—¶é—´ä¼šæ›´çŸ­ï¼›å¤§çš„å¹´è€ä»£ä¼šå‡å°‘Full GCçš„é¢‘ç‡</strong></p><p>å¦‚ä½•é€‰æ‹©åº”è¯¥ä¾èµ–åº”ç”¨ç¨‹åº<strong>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„åˆ†å¸ƒæƒ…å†µ</strong>ï¼š å¦‚æœåº”ç”¨å­˜åœ¨å¤§é‡çš„ä¸´æ—¶å¯¹è±¡ï¼Œåº”è¯¥é€‰æ‹©æ›´å¤§çš„å¹´è½»ä»£ï¼›å¦‚æœå­˜åœ¨ç›¸å¯¹è¾ƒå¤šçš„æŒä¹…å¯¹è±¡ï¼Œå¹´è€ä»£åº”è¯¥é€‚å½“å¢å¤§ã€‚ä½†å¾ˆå¤šåº”ç”¨éƒ½æ²¡æœ‰è¿™æ ·æ˜æ˜¾çš„ç‰¹æ€§ã€‚</p><p><strong>åœ¨æŠ‰æ‹©æ—¶åº”è¯¥æ ¹ æ®ä»¥ä¸‹ä¸¤ç‚¹ï¼š</strong></p><p>ï¼ˆ1ï¼‰æœ¬ç€Full GCå°½é‡å°‘çš„åŸåˆ™ï¼Œè®©å¹´è€ä»£å°½é‡ç¼“å­˜å¸¸ç”¨å¯¹è±¡ï¼ŒJVMçš„é»˜è®¤æ¯”ä¾‹1ï¼š2ä¹Ÿæ˜¯è¿™ä¸ªé“ç† ã€‚</p><p>ï¼ˆ2ï¼‰é€šè¿‡è§‚å¯Ÿåº”ç”¨ä¸€æ®µæ—¶é—´ï¼Œçœ‹å…¶ä»–åœ¨å³°å€¼æ—¶å¹´è€ä»£ä¼šå å¤šå°‘å†…å­˜ï¼Œåœ¨ä¸å½±å“Full GCçš„å‰æä¸‹ï¼Œæ ¹æ®å®é™…æƒ…å†µåŠ å¤§å¹´è½»ä»£ï¼Œæ¯”å¦‚å¯ä»¥æŠŠæ¯”ä¾‹æ§åˆ¶åœ¨1ï¼š1ã€‚ä½†åº”è¯¥ç»™å¹´è€ä»£è‡³å°‘é¢„ç•™1/3çš„å¢é•¿ç©ºé—´ã€‚</p><p><strong>4.åœ¨é…ç½®è¾ƒå¥½çš„æœºå™¨ä¸Šï¼ˆæ¯”å¦‚å¤šæ ¸ã€å¤§å†…å­˜ï¼‰ï¼Œå¯ä»¥ä¸ºå¹´è€ä»£é€‰æ‹©å¹¶è¡Œæ”¶é›†ç®—æ³•</strong>ï¼š <strong>-XX:+UseParallelOldGC</strong> <strong>ã€‚</strong></p><p><strong>5.çº¿ç¨‹å †æ ˆçš„è®¾ç½®</strong>ï¼šæ¯ä¸ªçº¿ç¨‹é»˜è®¤ä¼šå¼€å¯1Mçš„å †æ ˆï¼Œç”¨äºå­˜æ”¾æ ˆå¸§ã€è°ƒç”¨å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ï¼Œå¯¹å¤§å¤šæ•°åº”ç”¨è€Œè¨€è¿™ä¸ªé»˜è®¤å€¼å¤ªäº†ï¼Œä¸€èˆ¬256Kå°±è¶³ç”¨ã€‚</p><p>ç†è®ºä¸Šï¼Œåœ¨å†…å­˜ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå‡å°‘æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆï¼Œå¯ä»¥äº§ç”Ÿæ›´å¤šçš„çº¿ç¨‹ï¼Œä½†è¿™å®é™…ä¸Šè¿˜å—é™äºæ“ä½œç³»ç»Ÿã€‚</p><h2 id="_21-çº¿ä¸ŠæœåŠ¡cpuå ç”¨è¿‡é«˜æ€ä¹ˆæ’æŸ¥" tabindex="-1"><a class="header-anchor" href="#_21-çº¿ä¸ŠæœåŠ¡cpuå ç”¨è¿‡é«˜æ€ä¹ˆæ’æŸ¥" aria-hidden="true">#</a> 21.çº¿ä¸ŠæœåŠ¡CPUå ç”¨è¿‡é«˜æ€ä¹ˆæ’æŸ¥ï¼Ÿ</h2><p>é—®é¢˜åˆ†æï¼šCPUé«˜ä¸€å®šæ˜¯æŸä¸ªç¨‹åºé•¿æœŸå ç”¨äº†CPUèµ„æºã€‚</p><p>1ã€æ‰€ä»¥å…ˆéœ€è¦æ‰¾å‡ºé‚£ä¸ªè¿›ç¨‹å ç”¨CPUé«˜ã€‚</p><ul><li>top åˆ—å‡ºç³»ç»Ÿå„ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µã€‚</li></ul><p>2ã€ç„¶åæ ¹æ®æ‰¾åˆ°å¯¹åº”è¿›è¡Œé‡Œå“ªä¸ªçº¿ç¨‹å ç”¨CPUé«˜ã€‚</p><ul><li>top -Hp è¿›ç¨‹ID åˆ—å‡ºå¯¹åº”è¿›ç¨‹é‡Œé¢çš„çº¿ç¨‹å ç”¨èµ„æºæƒ…å†µ</li></ul><p>3ã€æ‰¾åˆ°å¯¹åº”çº¿ç¨‹IDåï¼Œå†æ‰“å°å‡ºå¯¹åº”çº¿ç¨‹çš„å †æ ˆä¿¡æ¯</p><ul><li>printf &quot;%x\n&quot; PID æŠŠçº¿ç¨‹IDè½¬æ¢ä¸º16è¿›åˆ¶ã€‚</li><li>jstack PID æ‰“å°å‡ºè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯ï¼Œä»æ‰“å°å‡ºæ¥çš„çº¿ç¨‹ä¿¡æ¯ä¸­æ‰¾åˆ°ä¸Šä¸€æ­¥è½¬æ¢ä¸º16è¿›åˆ¶çš„çº¿ç¨‹IDå¯¹åº”çš„çº¿ç¨‹ä¿¡æ¯ã€‚</li></ul><p>4ã€æœ€åæ ¹æ®çº¿ç¨‹çš„å †æ ˆä¿¡æ¯å®šä½åˆ°å…·ä½“ä¸šåŠ¡æ–¹æ³•,ä»ä»£ç é€»è¾‘ä¸­æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ã€‚</p><p>æŸ¥çœ‹æ˜¯å¦æœ‰çº¿ç¨‹é•¿æ—¶é—´çš„watting æˆ–blockedï¼Œå¦‚æœçº¿ç¨‹é•¿æœŸå¤„äºwattingçŠ¶æ€ä¸‹ï¼Œ å…³æ³¨watting on xxxxxxï¼Œè¯´æ˜çº¿ç¨‹åœ¨ç­‰å¾…è¿™æŠŠé”ï¼Œç„¶åæ ¹æ®é”çš„åœ°å€æ‰¾åˆ°æŒæœ‰é”çš„çº¿ç¨‹ã€‚</p><p>ä¹Ÿå¯ä»¥ç”¨Arthasæ’æŸ¥å®šä½é—®é¢˜</p><p><strong>Arthas</strong> æ˜¯é˜¿é‡Œå¼€æºçš„ Java è¯Šæ–­å·¥å…·ï¼Œç›¸æ¯” JDK å†…ç½®çš„è¯Šæ–­å·¥å…·ï¼Œè¦æ›´äººæ€§åŒ–ï¼Œå¹¶ä¸”åŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥å®ç°è®¸å¤šé—®é¢˜çš„ä¸€é”®å®šä½ï¼Œè€Œä¸”å¯ä»¥ä¸€é”®åç¼–è¯‘ç±»æŸ¥çœ‹æºç ï¼Œç”šè‡³æ˜¯ç›´æ¥è¿›è¡Œç”Ÿäº§ä»£ç çƒ­ä¿®å¤ï¼Œå®ç°åœ¨ä¸€ä¸ªå·¥å…·å†…å¿«é€Ÿå®šä½å’Œä¿®å¤é—®é¢˜çš„ä¸€ç«™å¼æœåŠ¡ã€‚</p><p>Arthas å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Falibaba.github.io%2Farthas%2F" target="_blank" rel="noopener noreferrer">alibaba.github.io/arthas/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="å¯åŠ¨-arthas" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨-arthas" aria-hidden="true">#</a> å¯åŠ¨ Arthas</h3><p>é¦–å…ˆï¼Œä¸‹è½½ Arthasï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Farthas.aliyun.com%2Farthas-boot.jar" target="_blank" rel="noopener noreferrer">arthas.aliyun.com/arthas-bootâ€¦<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ç„¶åæŠŠç¨‹åºå…ˆè¿è¡Œèµ·æ¥ï¼Œå†è¿è¡Œ arthasï¼šjava -jar arthas-boot.jar</p><p>å¯åŠ¨åï¼Œç›´æ¥æ‰¾åˆ°æˆ‘ä»¬è¦æ’æŸ¥çš„ JVM è¿›ç¨‹ï¼Œç„¶åå¯ä»¥çœ‹åˆ° Arthas é™„åŠ è¿›ç¨‹æˆåŠŸï¼š</p><figure><img src="/panshuilong.github.io/assets/2024032211261205-663d49b5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è¾“å…¥ help å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰æ”¯æŒçš„å‘½ä»¤åˆ—è¡¨ã€‚è¿™é‡Œä¸»è¦ä¼šç”¨åˆ° dashboardã€threadã€jadã€watch ç­‰å‘½ä»¤ï¼Œæ¥å®šä½é«˜CPUçš„é—®é¢˜ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032211277520-e2103b99.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="dashboard-â€”-å±•ç¤ºæ•´ä½“æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#dashboard-â€”-å±•ç¤ºæ•´ä½“æƒ…å†µ" aria-hidden="true">#</a> dashboard â€” å±•ç¤ºæ•´ä½“æƒ…å†µ</h3><p><code>dashboard</code> å‘½ä»¤æ•´ä½“å±•ç¤ºäº†è¿›ç¨‹æ‰€æœ‰çº¿ç¨‹ã€å†…å­˜ã€GC ç­‰æƒ…å†µï¼Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°ä¸¤ä¸ªCPUå ç”¨å¾ˆé«˜çš„çº¿ç¨‹ï¼Œä»çº¿ç¨‹åå­—æ¥çœ‹åº”è¯¥æ˜¯çº¿ç¨‹æ± çš„çº¿ç¨‹ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032211281023-9c8f9498.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="thread-â€”-æŸ¥çœ‹é«˜cpuçš„çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#thread-â€”-æŸ¥çœ‹é«˜cpuçš„çº¿ç¨‹" aria-hidden="true">#</a> thread â€” æŸ¥çœ‹é«˜CPUçš„çº¿ç¨‹</h3><p>æ¥ä¸‹æ¥ï¼ŒæŸ¥çœ‹æœ€ç¹å¿™çš„çº¿ç¨‹åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ ˆï¼Œå¯ä»¥ä½¿ç”¨ thread -n å‘½ä»¤ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹æœ€å¿™çš„ 2 ä¸ªçº¿ç¨‹ï¼šä»çº¿ç¨‹æ ˆå¯ä»¥çœ‹å‡ºï¼Œåº”è¯¥å°±æ˜¯ CpuService çš„ randomEncode æ–¹æ³•è°ƒç”¨ BCryptPasswordEncoder çš„ encode æ–¹æ³•å¯¼è‡´CPUè´Ÿè½½é«˜çš„ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032211293210-7b9726ad.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="watch-â€”-ç›‘æ§å‚æ•°" tabindex="-1"><a class="header-anchor" href="#watch-â€”-ç›‘æ§å‚æ•°" aria-hidden="true">#</a> watch â€” ç›‘æ§å‚æ•°</h3><p>å¦‚æœæƒ³è¦è§‚å¯Ÿæ–¹æ³•çš„å…¥å‚å’Œå‡ºå‚ï¼Œå¯ä»¥ç”¨ watch å‘½ä»¤æ¥è§‚å¯Ÿï¼š</p><figure><img src="/panshuilong.github.io/assets/2024032211304250-b4332b68.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="jad-â€”-åç¼–è¯‘" tabindex="-1"><a class="header-anchor" href="#jad-â€”-åç¼–è¯‘" aria-hidden="true">#</a> jad â€” åç¼–è¯‘</h3><figure><img src="/panshuilong.github.io/assets/2024032211315203-050c76bb.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="redefine-â€”-é‡è½½ç±»" tabindex="-1"><a class="header-anchor" href="#redefine-â€”-é‡è½½ç±»" aria-hidden="true">#</a> redefine â€” é‡è½½ç±»</h3><p>å¦‚æœæˆ‘ä»¬æƒ³åšçº¿ä¸Šè°ƒè¯•ï¼Œåˆä¸æƒ³åœ¨æœ¬åœ°æ”¹ä»£ç ï¼Œæ‰“å°æ—¥å¿—ï¼Œå†æäº¤åˆ°æœåŠ¡å™¨ï¼Œå†é‡å¯æœåŠ¡æµ‹è¯•ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç»“åˆ arthas çš„ jadã€mcã€redefine æ¥åŠ¨æ€é‡å®šä¹‰ç±»ã€‚</p><p>1ã€é¦–å…ˆç”¨ jad æŠŠæºæ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p><figure><img src="/panshuilong.github.io/assets/2024032211321054-beb31896.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç„¶åä¿®æ”¹ä¸‹æºç ï¼šæ·»åŠ äº†ä¸€è¡Œè¾“å‡ºæ—¥å¿—</p><figure><img src="/panshuilong.github.io/assets/2024032211332302-a56cb758.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>2ã€ä½¿ç”¨ mc å‘½ä»¤åç¼–è¯‘æºæ–‡ä»¶</p><p>åç¼–è¯‘åä¼šç”Ÿæˆå¯¹åº”çš„ class æ–‡ä»¶ï¼š</p><figure><img src="/panshuilong.github.io/assets/2024032211331025-56e32758.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>3ã€ä½¿ç”¨ redefine é‡è½½ç±»</p><figure><img src="/panshuilong.github.io/assets/2024032211345630-3746defb.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å°±å¯ä»¥çœ‹åˆ°æ§åˆ¶å°å·²ç»åœ¨è¾“å‡ºæˆ‘ä»¬æ‰“å°çš„æ—¥å¿—äº†</p><p>éœ€è¦é¢å¤–è¯´æ˜çš„æ˜¯ï¼Œç”±äº monitorã€traceã€watch ç­‰å‘½ä»¤æ˜¯é€šè¿‡å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¥å®ç°çš„ï¼Œä¼šåœ¨æŒ‡å®šç±»çš„æ–¹æ³•ä¸­æ’å…¥ä¸€äº›åˆ‡é¢æ¥å®ç°æ•°æ®ç»Ÿè®¡å’Œè§‚æµ‹ï¼Œå› æ­¤è¯Šæ–­ç»“æŸè¦æ‰§è¡Œ shutdown æ¥è¿˜åŸç±»æˆ–æ–¹æ³•å­—èŠ‚ç ï¼Œç„¶åé€€å‡º Arthasã€‚</p><h2 id="_22-å†…å­˜é£™é«˜é—®é¢˜æ€ä¹ˆæ’æŸ¥" tabindex="-1"><a class="header-anchor" href="#_22-å†…å­˜é£™é«˜é—®é¢˜æ€ä¹ˆæ’æŸ¥" aria-hidden="true">#</a> 22.å†…å­˜é£™é«˜é—®é¢˜æ€ä¹ˆæ’æŸ¥ï¼Ÿ</h2><p>åˆ†æï¼šå†…å­˜é£šé«˜å¦‚æœæ˜¯å‘ç”Ÿåœ¨javaè¿›ç¨‹ä¸Šï¼Œä¸€èˆ¬æ˜¯å› ä¸ºåˆ›å»ºäº†å¤§é‡å¯¹è±¡æ‰€å¯¼è‡´ï¼ŒæŒç»­é£šé«˜è¯´æ˜åƒåœ¾å›æ”¶è·Ÿä¸ä¸Šå¯¹è±¡åˆ›å»ºçš„é€Ÿåº¦ï¼Œæˆ–è€…å†…å­˜æ³„éœ²å¯¼è‡´å¯¹è±¡æ— æ³•å›æ”¶ã€‚</p><p>1ã€å…ˆè§‚å¯Ÿåƒåœ¾å›æ”¶çš„æƒ…å†µ</p><ul><li>jstat -gc PID 1000 æŸ¥çœ‹GCæ¬¡æ•°ï¼Œæ—¶é—´ç­‰ä¿¡æ¯ï¼Œæ¯éš”ä¸€ç§’æ‰“å°ä¸€æ¬¡ã€‚</li><li>jmap -histo PID | head -20 æŸ¥çœ‹å †å†…å­˜å ç”¨ç©ºé—´æœ€å¤§çš„å‰20ä¸ªå¯¹è±¡ç±»å‹,å¯åˆæ­¥æŸ¥çœ‹æ˜¯å“ªä¸ªå¯¹è±¡å ç”¨äº†å†…å­˜ã€‚</li></ul><p>å¦‚æœæ¯æ¬¡GCæ¬¡æ•°é¢‘ç¹ï¼Œè€Œä¸”æ¯æ¬¡å›æ”¶çš„å†…å­˜ç©ºé—´ä¹Ÿæ­£å¸¸ï¼Œé‚£è¯´æ˜æ˜¯å› ä¸ºå¯¹è±¡åˆ›å»ºé€Ÿåº¦å¿«å¯¼è‡´å†…å­˜ä¸€ç›´å ç”¨å¾ˆé«˜ï¼›å¦‚æœæ¯æ¬¡å›æ”¶çš„å†…å­˜éå¸¸å°‘ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½æ˜¯å› ä¸ºå†…å­˜æ³„éœ²å¯¼è‡´å†…å­˜ä¸€ç›´æ— æ³•è¢«å›æ”¶ã€‚</p><p>2ã€å¯¼å‡ºå †å†…å­˜æ–‡ä»¶å¿«ç…§</p><ul><li>jmap -dump:live,format=b,file=/home/myheapdump.hprof PID dumpå †å†…å­˜ä¿¡æ¯åˆ°æ–‡ä»¶ã€‚</li></ul><p>å¦‚æœä¼šæŒ‚æ‰</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>-XX:+HeapDumpOnOutOfMemoryError 
-XX:HeapDumpPath=/crashes/my-heap-dump.hprof
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€ä½¿ç”¨visualVMå¯¹dumpæ–‡ä»¶è¿›è¡Œç¦»çº¿åˆ†æï¼Œæ‰¾åˆ°å ç”¨å†…å­˜é«˜çš„å¯¹è±¡ï¼Œå†æ‰¾åˆ°åˆ›å»ºè¯¥å¯¹è±¡çš„ä¸šåŠ¡ä»£ç ä½ç½®ï¼Œä»ä»£ç å’Œä¸šåŠ¡åœºæ™¯ä¸­å®šä½å…·ä½“é—®é¢˜ã€‚</p><h2 id="_23-é¢‘ç¹-minor-gc-æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#_23-é¢‘ç¹-minor-gc-æ€ä¹ˆåŠ" aria-hidden="true">#</a> 23.é¢‘ç¹ minor gc æ€ä¹ˆåŠï¼Ÿ</h2><p>ä¼˜åŒ–Minor GCé¢‘ç¹é—®é¢˜ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œç”±äºæ–°ç”Ÿä»£ç©ºé—´è¾ƒå°ï¼ŒEdenåŒºå¾ˆå¿«è¢«å¡«æ»¡ï¼Œå°±ä¼šå¯¼è‡´é¢‘ç¹Minor GCï¼Œå› æ­¤å¯ä»¥é€šè¿‡å¢å¤§æ–°ç”Ÿä»£ç©ºé—´-Xmnæ¥é™ä½Minor GCçš„é¢‘ç‡ã€‚</p><h2 id="_24-é¢‘ç¹full-gcæ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#_24-é¢‘ç¹full-gcæ€ä¹ˆåŠ" aria-hidden="true">#</a> 24.é¢‘ç¹Full GCæ€ä¹ˆåŠï¼Ÿ</h2><p>Full GCçš„æ’æŸ¥æ€è·¯å¤§æ¦‚å¦‚ä¸‹ï¼š</p><ol><li>æ¸…æ¥šä»ç¨‹åºè§’åº¦ï¼Œæœ‰å“ªäº›åŸå› å¯¼è‡´FGCï¼Ÿ</li></ol><ul><li><strong>å¤§å¯¹è±¡</strong>ï¼šç³»ç»Ÿä¸€æ¬¡æ€§åŠ è½½äº†è¿‡å¤šæ•°æ®åˆ°å†…å­˜ä¸­ï¼ˆæ¯”å¦‚SQLæŸ¥è¯¢æœªåšåˆ†é¡µï¼‰ï¼Œå¯¼è‡´å¤§å¯¹è±¡è¿›å…¥äº†è€å¹´ä»£ã€‚</li><li><strong>å†…å­˜æ³„æ¼</strong>ï¼šé¢‘ç¹åˆ›å»ºäº†å¤§é‡å¯¹è±¡ï¼Œä½†æ˜¯æ— æ³•è¢«å›æ”¶ï¼ˆæ¯”å¦‚IOå¯¹è±¡ä½¿ç”¨å®Œåæœªè°ƒç”¨closeæ–¹æ³•é‡Šæ”¾èµ„æºï¼‰ï¼Œå…ˆå¼•å‘FGCï¼Œæœ€åå¯¼è‡´OOM.</li><li>ç¨‹åºé¢‘ç¹ç”Ÿæˆä¸€äº›<strong>é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡</strong>ï¼Œå½“è¿™äº›å¯¹è±¡çš„å­˜æ´»å¹´é¾„è¶…è¿‡åˆ†ä»£å¹´é¾„æ—¶ä¾¿ä¼šè¿›å…¥è€å¹´ä»£ï¼Œæœ€åå¼•å‘FGC.</li><li><strong>ç¨‹åºBUG</strong></li><li>ä»£ç ä¸­<strong>æ˜¾å¼è°ƒç”¨äº†gc</strong>æ–¹æ³•ï¼ŒåŒ…æ‹¬è‡ªå·±çš„ä»£ç ç”šè‡³æ¡†æ¶ä¸­çš„ä»£ç ã€‚</li><li>JVMå‚æ•°è®¾ç½®é—®é¢˜ï¼šåŒ…æ‹¬æ€»å†…å­˜å¤§å°ã€æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°ã€EdenåŒºå’ŒSåŒºçš„å¤§å°ã€å…ƒç©ºé—´å¤§å°ã€åƒåœ¾å›æ”¶ç®—æ³•ç­‰ç­‰ã€‚</li></ul><ol><li>æ¸…æ¥šæ’æŸ¥é—®é¢˜æ—¶èƒ½ä½¿ç”¨å“ªäº›å·¥å…·</li></ol><ul><li>å…¬å¸çš„ç›‘æ§ç³»ç»Ÿï¼šå¤§éƒ¨åˆ†å…¬å¸éƒ½ä¼šæœ‰ï¼Œå¯å…¨æ–¹ä½ç›‘æ§JVMçš„å„é¡¹æŒ‡æ ‡ã€‚</li><li>JDKçš„è‡ªå¸¦å·¥å…·ï¼ŒåŒ…æ‹¬jmapã€jstatç­‰å¸¸ç”¨å‘½ä»¤ï¼š</li></ul><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code># æŸ¥çœ‹å †å†…å­˜å„åŒºåŸŸçš„ä½¿ç”¨ç‡ä»¥åŠGCæƒ…å†µ
jstat -gcutil -h20 pid 1000
# æŸ¥çœ‹å †å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶æŒ‰ç©ºé—´æ’åº
jmap -histo pid | head -n20
# dumpå †å†…å­˜æ–‡ä»¶
jmap -dump:format=b,file=heap pid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯è§†åŒ–çš„å †å†…å­˜åˆ†æå·¥å…·ï¼šJVisualVMã€MATç­‰</li></ul><ol><li>æ’æŸ¥æŒ‡å—</li></ol><ul><li>æŸ¥çœ‹ç›‘æ§ï¼Œä»¥äº†è§£å‡ºç°é—®é¢˜çš„æ—¶é—´ç‚¹ä»¥åŠå½“å‰FGCçš„é¢‘ç‡ï¼ˆå¯å¯¹æ¯”æ­£å¸¸æƒ…å†µçœ‹é¢‘ç‡æ˜¯å¦æ­£å¸¸ï¼‰</li><li>äº†è§£è¯¥æ—¶é—´ç‚¹ä¹‹å‰æœ‰æ²¡æœ‰ç¨‹åºä¸Šçº¿ã€åŸºç¡€ç»„ä»¶å‡çº§ç­‰æƒ…å†µã€‚</li><li>äº†è§£JVMçš„å‚æ•°è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼šå †ç©ºé—´å„ä¸ªåŒºåŸŸçš„å¤§å°è®¾ç½®ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£åˆ†åˆ«é‡‡ç”¨äº†å“ªäº›åƒåœ¾æ”¶é›†å™¨ï¼Œç„¶ååˆ†æJVMå‚æ•°è®¾ç½®æ˜¯å¦åˆç†ã€‚</li><li>å†å¯¹æ­¥éª¤1ä¸­åˆ—å‡ºçš„å¯èƒ½åŸå› åšæ’é™¤æ³•ï¼Œå…¶ä¸­å…ƒç©ºé—´è¢«æ‰“æ»¡ã€å†…å­˜æ³„æ¼ã€ä»£ç æ˜¾å¼è°ƒç”¨gcæ–¹æ³•æ¯”è¾ƒå®¹æ˜“æ’æŸ¥ã€‚</li><li>é’ˆå¯¹å¤§å¯¹è±¡æˆ–è€…é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å¯¼è‡´çš„FGCï¼Œå¯é€šè¿‡ jmap -histo å‘½ä»¤å¹¶ç»“åˆdumpå †å†…å­˜æ–‡ä»¶ä½œè¿›ä¸€æ­¥åˆ†æï¼Œéœ€è¦å…ˆå®šä½åˆ°å¯ç–‘å¯¹è±¡ã€‚</li><li>é€šè¿‡å¯ç–‘å¯¹è±¡å®šä½åˆ°å…·ä½“ä»£ç å†æ¬¡åˆ†æï¼Œè¿™æ—¶å€™è¦ç»“åˆGCåŸç†å’ŒJVMå‚æ•°è®¾ç½®ï¼Œå¼„æ¸…æ¥šå¯ç–‘å¯¹è±¡æ˜¯å¦æ»¡è¶³äº†è¿›å…¥åˆ°è€å¹´ä»£çš„æ¡ä»¶æ‰èƒ½ä¸‹ç»“è®ºã€‚</li></ul><h2 id="_25-æœ‰æ²¡æœ‰å¤„ç†è¿‡å†…å­˜æº¢å‡º-oom-é—®é¢˜-æ˜¯å¦‚ä½•å®šä½çš„" tabindex="-1"><a class="header-anchor" href="#_25-æœ‰æ²¡æœ‰å¤„ç†è¿‡å†…å­˜æº¢å‡º-oom-é—®é¢˜-æ˜¯å¦‚ä½•å®šä½çš„" aria-hidden="true">#</a> 25.æœ‰æ²¡æœ‰å¤„ç†è¿‡å†…å­˜æº¢å‡º(OOM)é—®é¢˜ï¼Ÿæ˜¯å¦‚ä½•å®šä½çš„ï¼Ÿ</h2><p>å¯¹äºæ’æŸ¥ OOM é—®é¢˜ã€åˆ†æç¨‹åºå †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯åˆ†æå †è½¬å‚¨ï¼Œå †è½¬å‚¨ï¼ŒåŒ…å«äº†å †ç°åœºå…¨è²Œå’Œçº¿ç¨‹æ ˆä¿¡æ¯ã€‚è¿™èŠ‚å°±æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨MATåˆ†æOOMé—®é¢˜ã€‚</p><h3 id="mat-åˆ†æoomé—®é¢˜çš„æ€è·¯" tabindex="-1"><a class="header-anchor" href="#mat-åˆ†æoomé—®é¢˜çš„æ€è·¯" aria-hidden="true">#</a> MAT åˆ†æOOMé—®é¢˜çš„æ€è·¯</h3><p>å¯¹äºçº¿ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½é€šè¿‡æ—¥å¿—å¿«é€Ÿå®šä½å‡ºOOMçš„æ ¹æºï¼Œä¸€èˆ¬å°±å¯ä»¥ä½¿ç”¨MATæ¥åˆ†æOOMçš„é—®é¢˜ã€‚</p><p>ä½¿ç”¨ MAT åˆ†æ OOM é—®é¢˜ï¼Œä¸€èˆ¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ€è·¯è¿›è¡Œï¼š</p><ul><li>é€šè¿‡æ”¯é…æ ‘åŠŸèƒ½æˆ–ç›´æ–¹å›¾åŠŸèƒ½æŸ¥çœ‹æ¶ˆè€—å†…å­˜æœ€å¤§çš„ç±»å‹ï¼Œæ¥åˆ†æå†…å­˜æ³„éœ²çš„å¤§æ¦‚åŸå› ï¼›</li><li>æŸ¥çœ‹é‚£äº›æ¶ˆè€—å†…å­˜æœ€å¤§çš„ç±»å‹ã€è¯¦ç»†çš„å¯¹è±¡æ˜ç»†åˆ—è¡¨ï¼Œä»¥åŠå®ƒä»¬çš„å¼•ç”¨é“¾ï¼Œæ¥å®šä½å†…å­˜æ³„éœ²çš„å…·ä½“ç‚¹ï¼›</li><li>é…åˆæŸ¥çœ‹å¯¹è±¡å±æ€§çš„åŠŸèƒ½ï¼Œå¯ä»¥è„±ç¦»æºç çœ‹åˆ°å¯¹è±¡çš„å„ç§å±æ€§çš„å€¼å’Œä¾èµ–å…³ç³»ï¼Œå¸®åŠ©æˆ‘ä»¬ç†æ¸…ç¨‹åºé€»è¾‘å’Œå‚æ•°ï¼›</li><li>è¾…åŠ©ä½¿ç”¨æŸ¥çœ‹çº¿ç¨‹æ ˆæ¥çœ‹ OOM é—®é¢˜æ˜¯å¦å’Œè¿‡å¤šçº¿ç¨‹æœ‰å…³ï¼Œç”šè‡³å¯ä»¥åœ¨çº¿ç¨‹æ ˆçœ‹åˆ° OOM æœ€åä¸€åˆ»å‡ºç°å¼‚å¸¸çš„çº¿ç¨‹ã€‚</li></ul><p>å¦‚æœdumpå‡ºæ¥çš„å†…å­˜å¿«ç…§å¾ˆå¤§ï¼Œæ¯”å¦‚æœ‰å‡ ä¸ªGï¼ŒåŠ¡å¿…åœ¨å¯åŠ¨MATä¹‹å‰ï¼Œå…ˆåœ¨é…ç½®æ–‡ä»¶ï¼ˆMemoryAnalyzer.iniï¼‰é‡Œç»™MATæœ¬èº«è®¾ç½®â€”ä¸‹å †å†…å­˜å¤§å°ï¼ˆé»˜è®¤ä¸º1024mï¼‰ï¼Œæ¯”å¦‚è®¾ç½®ä¸º4ä¸ªGï¼Œæˆ–è€…8ä¸ªGã€‚</p><h3 id="æ€»è§ˆå›¾-â€”-å¿«é€Ÿåˆ†æoomé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#æ€»è§ˆå›¾-â€”-å¿«é€Ÿåˆ†æoomé—®é¢˜" aria-hidden="true">#</a> æ€»è§ˆå›¾ â€” å¿«é€Ÿåˆ†æOOMé—®é¢˜</h3><p>ä½¿ç”¨MATæ‰“å¼€å †è½¬å‚¨æ–‡ä»¶ dump.hprofï¼Œæ‰“å¼€åå…ˆè¿›å…¥çš„æ˜¯æ¦‚è§ˆä¿¡æ¯ç•Œé¢ï¼š</p><p>ä»é¥¼å›¾å¯ä»¥çœ‹å‡ºï¼Œæ˜æ˜¾æœ‰å¯¹è±¡å ç”¨äº†å¤§é‡å†…å­˜ï¼Œç„¶åå†çœ‹ <strong>Problem Suspect1</strong>ï¼Œå·²ç»è¯´æ˜äº† main çº¿ç¨‹é€šè¿‡å±€éƒ¨å˜é‡å æ®äº† 99.42% å†…å­˜çš„å¯¹è±¡ï¼Œè€Œä¸”æ˜¯ java.lang.Object[] æ•°ç»„å æ®äº†å¤§é‡å†…å­˜ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032215402103-b2f7f892.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç‚¹å‡» <strong>Details</strong> è¿›å»æŸ¥çœ‹è¯¦ç»†çš„è¯´æ˜ï¼Œä» â€œAccumulated Objects in Dominator Treeâ€ æ”¯é…æ ‘å¯ä»¥çœ‹å‡ºï¼Œmain çº¿ç¨‹å¼•ç”¨äº† OomService å¯¹è±¡ï¼ŒOomService å¼•ç”¨äº†ä¸€ä¸ª ArrayList å¯¹è±¡ï¼Œç„¶å ArrayList å­˜å‚¨äº†å¤§é‡ String å¯¹è±¡ã€‚è¿™é‡ŒåŸºæœ¬ä¸Šå°±èƒ½åˆ†æå‡ºOOMçš„æ ¹æºäº†ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032215412581-e3803202.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å†ç‚¹å‡» <strong>See stacktrace</strong> çœ‹çœ‹çº¿ç¨‹æ ˆåŸºæœ¬å°±èƒ½å®šä½åˆ°é—®é¢˜ä»£ç äº†ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032215432015-c73ad1bf.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="ç›´æ–¹å›¾-â€”-å®šä½æ ¹æº" tabindex="-1"><a class="header-anchor" href="#ç›´æ–¹å›¾-â€”-å®šä½æ ¹æº" aria-hidden="true">#</a> ç›´æ–¹å›¾ â€” å®šä½æ ¹æº</h3><p>å·¥å…·æ çš„ç¬¬äºŒä¸ªæŒ‰é’®å¯ä»¥æ‰“å¼€ç›´æ–¹å›¾ï¼Œç›´æ–¹å›¾æŒ‰ç…§ç±»å‹è¿›è¡Œåˆ†ç»„ï¼Œåˆ—å‡ºäº†æ¯ä¸ªç±»æœ‰å¤šå°‘ä¸ªå®ä¾‹ï¼Œä»¥åŠå ç”¨çš„å†…å­˜ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œchar[] å­—èŠ‚æ•°ç»„å ç”¨å†…å­˜æœ€å¤šï¼Œå¯¹è±¡æ•°é‡ä¹Ÿå¾ˆå¤šï¼Œç¬¬äºŒä½çš„ String å¯¹è±¡æ•°é‡ä¹Ÿéå¸¸å¤šï¼Œæœ‰ 9791 ä¸ªï¼Œä»è¿™å¤§æ¦‚å¯ä»¥çŒœå‡ºåº”è¯¥æ˜¯åˆ›å»ºäº†å¤§é‡çš„ String å¯¹è±¡ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032215436321-50141e13.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åœ¨ char[] ä¸Šç‚¹å‡»å³é”®ï¼Œé€‰æ‹© List objects -&gt; with incoming referencesï¼Œå°±å¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„ char[] å®ä¾‹ï¼Œä»¥åŠæ¯ä¸ª char[] çš„æ•´ä¸ªå¼•ç”¨å…³ç³»é“¾ï¼š</p><figure><img src="/panshuilong.github.io/assets/2024032215441782-c98b01a7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>éšæœºå±•å¼€ä¸€ä¸ª char[]ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>å³ä¾§æ¡†ä¸­å¯ä»¥çœ‹åˆ°æ•´ä¸ªå¼•ç”¨é“¾ï¼Œå·¦ä¾§çš„æ¡†å¯ä»¥æŸ¥çœ‹æ¯ä¸€ä¸ªå®ä¾‹çš„å†…éƒ¨å±æ€§ã€‚</p><p>é€šè¿‡è¿™ä¸ªå¼•ç”¨é“¾å¯ä»¥å‘ç°æ˜¯ String å¯¹è±¡å¼•ç”¨äº† byte[] æ•°ç»„ï¼ˆString çš„å†…éƒ¨ç»“æ„å°±æ˜¯ä¸€ä¸ª byte[] æ•°ç»„ï¼‰ï¼Œè¯´æ˜åˆ›å»ºäº†å¤§é‡çš„ String å¯¹è±¡ï¼›ç„¶å String å¯¹è±¡åˆè¢« ArrayList çš„ Object[] æ•°ç»„å¼•ç”¨ç€ï¼Œè¯´æ˜æ˜¯å¤§é‡ String å¯¹è±¡æ”¾å…¥äº† ArrayList ä¸­ã€‚åˆ°è¿™é‡Œå°±å®šä½å‡ºäº†å¼•å‘OOMçš„ç±»äº†ã€‚</p><p><strong>Retained Heapï¼ˆæ·±å †ï¼‰</strong> ä»£è¡¨å¯¹è±¡æœ¬èº«å’Œå¯¹è±¡å…³è”çš„å¯¹è±¡å ç”¨çš„å†…å­˜ï¼Œ<strong>Shallow Heapï¼ˆæµ…å †ï¼‰</strong> ä»£è¡¨å¯¹è±¡æœ¬èº«å ç”¨çš„å†…å­˜ã€‚æ¯”å¦‚ï¼ŒOOMTest ä¸­çš„è¿™ä¸ª ArrayList å¯¹è±¡æœ¬èº«åªæœ‰ 24 å­—èŠ‚ï¼Œä½†æ˜¯å…¶æ‰€æœ‰å…³è”çš„å¯¹è±¡å ç”¨äº†å¤§æ¦‚5MB å†…å­˜ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032215451236-d3dabf4e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚æœå¸Œæœ›çœ‹åˆ°å®Œæ•´å†…å®¹çš„è¯ï¼Œå¯ä»¥å³é”®é€‰æ‹© Copy-&gt;Valueï¼ŒæŠŠå€¼å¤åˆ¶åˆ°å‰ªè´´æ¿æˆ–ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼š</p><figure><img src="/panshuilong.github.io/assets/2024032215468520-cd06d81f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="çº¿ç¨‹æ ˆ-â€”-åˆ†æä»£ç " tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹æ ˆ-â€”-åˆ†æä»£ç " aria-hidden="true">#</a> çº¿ç¨‹æ ˆ â€” åˆ†æä»£ç </h3><p>å¯ä»¥ç‚¹å‡»å·¥å…·æ çš„ç¬¬äº”ä¸ªæŒ‰é’®ï¼Œæ‰“å¼€çº¿ç¨‹è§†å›¾æ¥åˆ†æ OOMTest æ‰§è¡Œä»€ä¹ˆé€»è¾‘ã€‚</p><figure><img src="/panshuilong.github.io/assets/2024032215478521-6930ac60.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/panslong/panslong.github.io/edit/main/docs/Java/JVM/2024-03-21-JVM-é«˜é¢‘é¢è¯•é¢˜.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 1063589459@qq.com">panshuilong</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2024 ä¸ƒåˆ†ç†Ÿ</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/panshuilong.github.io/assets/app-058da2fa.js" defer></script>
  </body>
</html>
